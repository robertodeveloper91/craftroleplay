<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>CRAFT ROLEPLAY ‚Äî Calculator Profesional 2026</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî´</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800;900&family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>

:root {
  --p: #ff6b35; --pd: #cc5529; --s: #ffd700; --a: #00d4ff;
  --g: #00ff88; --r: #ff3366; --violet: #b44dff;
  --cu: #b87333; --pb: #6b7b8c; --gunp: #7a7a7a;
  --bg: #060610; --bg2: #0c0c18; --cd: #10101c; --cd2: #161625;
  --inp: #1a1a2a; --tx: #eeeef6; --dm: #6b6b8a; --bd: #252540;
  --glow-p: rgba(255,107,53,.4); --glow-s: rgba(255,215,0,.4);
  --glow-a: rgba(0,212,255,.4); --glow-g: rgba(0,255,136,.4);
  --owner: #ff0000; --owner-glow: rgba(255,0,0,.4);
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box }
html { scroll-behavior: smooth }
body {
  font-family: 'Rajdhani', 'Segoe UI', sans-serif;
  background: var(--bg); color: var(--tx);
  min-height: 100vh; overflow-x: hidden;
  font-size: 16px; line-height: 1.5;
}

/* === LOGIN SCREEN === */
#login-screen {
  position: fixed; inset: 0; z-index: 10000;
  background: linear-gradient(135deg, var(--bg) 0%, #0a0a1a 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 20px;
}
.login-box {
  background: linear-gradient(145deg, var(--cd), var(--cd2));
  border: 2px solid var(--bd); border-radius: 24px;
  padding: 50px 40px; max-width: 480px; width: 100%;
  text-align: center; position: relative;
  box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 40px rgba(88,101,242,.1);
}
.login-box::before {
  content:''; position:absolute; top:0; left:0; width:100%; height:4px;
  background: linear-gradient(90deg, #5865F2, #7289da, #5865F2);
  border-radius: 24px 24px 0 0;
}
.login-logo {
  font-family: 'Orbitron', monospace; font-size: 2rem; font-weight: 900;
  background: linear-gradient(135deg, #5865F2, #7289da);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  margin-bottom: 10px; letter-spacing: 3px;
}
.login-sub { color: var(--dm); font-size: .9rem; margin-bottom: 30px; }
.discord-btn {
  display: inline-flex; align-items: center; gap: 12px;
  padding: 16px 32px; background: linear-gradient(135deg, #5865F2, #4752C4);
  border: none; border-radius: 12px; color: white;
  font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; font-weight: 700;
  cursor: pointer; transition: all .3s; text-decoration: none;
  box-shadow: 0 4px 20px rgba(88,101,242,.3);
}
.discord-btn:hover {
  transform: translateY(-2px); box-shadow: 0 8px 30px rgba(88,101,242,.4);
}
.discord-btn svg { width: 24px; height: 24px; }
.owner-badge {
  display: inline-block;
  background: linear-gradient(135deg, var(--owner), #cc0000);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-top: 10px;
  box-shadow: 0 0 20px var(--owner-glow);
  animation: pulse 2s infinite;
}
.pending-box {
  background: rgba(255,193,7,.1); border: 1px solid rgba(255,193,7,.3);
  border-radius: 12px; padding: 20px; margin-top: 20px;
}
.pending-box h3 { color: #ffc107; margin-bottom: 10px; font-family: 'Orbitron', monospace; }
.pending-box p { color: var(--dm); font-size: .9rem; }
.user-info {
  display: flex; align-items: center; gap: 15px; margin-bottom: 20px;
  padding: 15px; background: rgba(0,0,0,.2); border-radius: 12px;
}
.user-avatar { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #5865F2; }
.user-avatar.owner { border-color: var(--owner); box-shadow: 0 0 20px var(--owner-glow); }
.user-details { text-align: left; }
.user-name { font-weight: 700; color: var(--tx); font-size: 1.1rem; }
.user-name.owner { color: var(--owner); text-shadow: 0 0 10px var(--owner-glow); }
.user-id { font-family: 'JetBrains Mono', monospace; font-size: .75rem; color: var(--dm); }

/* === ADMIN PANEL === */
#admin-panel {
  display: none; position: fixed; top: 20px; right: 20px; z-index: 9999;
  background: linear-gradient(145deg, var(--cd), var(--cd2));
  border: 2px solid var(--owner); border-radius: 16px;
  padding: 20px; width: 500px; max-height: 90vh; overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,.5), 0 0 30px var(--owner-glow);
}
#admin-panel h3 {
  font-family: 'Orbitron', monospace; color: var(--owner);
  margin-bottom: 15px; display: flex; align-items: center; gap: 8px;
  text-shadow: 0 0 20px var(--owner-glow);
}
.admin-btn {
  position: fixed; top: 20px; right: 20px; z-index: 9998;
  padding: 12px 20px; background: linear-gradient(135deg, var(--owner), #990000);
  border: none; border-radius: 10px; color: white;
  font-family: 'Rajdhani', sans-serif; font-weight: 700; cursor: pointer;
  box-shadow: 0 4px 15px var(--owner-glow);
  animation: pulse 2s infinite;
}
.user-list { display: flex; flex-direction: column; gap: 10px; }
.user-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px; background: rgba(0,0,0,.2); border-radius: 10px;
  border: 1px solid var(--bd);
}
.user-item.owner { border-color: var(--owner); background: rgba(255,0,0,.1); }
.user-item span { font-size: .85rem; }
.action-btns { display: flex; gap: 6px; }
.action-btn {
  padding: 6px 12px; border: none; border-radius: 6px;
  font-size: .75rem; font-weight: 700; cursor: pointer; transition: .2s;
}
.approve-btn { background: var(--g); color: #000; }
.reject-btn { background: var(--r); color: #fff; }
.remove-btn { background: var(--dm); color: #fff; }
.owner-btn { background: var(--owner); color: #fff; }
.stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
.stat-box {
  padding: 10px; background: rgba(0,0,0,.2); border-radius: 8px; text-align: center;
}
.stat-box .num { font-size: 1.5rem; font-weight: 900; color: var(--s); }
.stat-box .lbl { font-size: .7rem; color: var(--dm); text-transform: uppercase; }

/* === CATEGORY MANAGER === */
.category-manager {
  margin-top: 20px;
  border-top: 2px solid var(--owner);
  padding-top: 20px;
}
.category-manager h4 {
  font-family: 'Orbitron', monospace; color: var(--owner);
  margin-bottom: 15px; font-size: 0.9rem;
}
.category-list {
  display: flex;
  flex-direction: column;
  gap: 10px; margin-bottom: 15px;
  max-height: 200px; overflow-y: auto;
}
.category-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px; background: rgba(0,0,0,.2);
  border: 1px solid var(--bd); border-radius: 10px;
}
.category-item.active {
  border-color: var(--g);
  background: rgba(0,255,136,.05);
}
.category-info {
  display: flex; align-items: center; gap: 10px;
}
.category-icon {
  font-size: 1.5rem;
}
.category-name {
  font-weight: 700; color: var(--tx);
}
.category-id {
  font-size: 0.7rem; color: var(--dm);
  font-family: 'JetBrains Mono', monospace;
}
.category-tabs {
  display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 15px;
}
.cat-tab {
  padding: 8px 14px; background: var(--inp); border: 1px solid var(--bd);
  border-radius: 8px; color: var(--dm); font-size: 0.75rem; font-weight: 700;
  cursor: pointer; transition: all .3s; font-family: 'Rajdhani', sans-serif;
}
.cat-tab:hover { border-color: var(--owner); color: var(--tx); }
.cat-tab.active {
  background: linear-gradient(135deg, rgba(255,0,0,.15), rgba(255,0,0,.05));
  border-color: var(--owner); color: var(--owner);
  box-shadow: 0 0 15px var(--owner-glow);
}
.data-list {
  max-height: 300px; overflow-y: auto;
  display: flex; flex-direction: column; gap: 8px;
  margin-bottom: 15px;
}
.data-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px; background: rgba(0,0,0,.2); border-radius: 10px;
  border: 1px solid var(--bd); transition: all .3s;
}
.data-item:hover { border-color: var(--owner); background: rgba(255,0,0,.05); }
.data-item-info { flex: 1; }
.data-item-name {
  font-weight: 700; color: var(--tx); font-size: 0.9rem;
  display: flex; align-items: center; gap: 8px;
}
.data-item-meta {
  font-size: 0.7rem; color: var(--dm); margin-top: 4px;
  font-family: 'JetBrains Mono', monospace;
}
.data-item-actions { display: flex; gap: 5px; }
.icon-btn {
  width: 32px; height: 32px; border: none; border-radius: 6px;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: all .3s; font-size: 1rem;
}
.icon-btn.edit { background: rgba(255,215,0,.1); color: var(--s); border: 1px solid rgba(255,215,0,.3); }
.icon-btn.edit:hover { background: rgba(255,215,0,.2); box-shadow: 0 0 10px rgba(255,215,0,.3); }
.icon-btn.delete { background: rgba(255,51,102,.1); color: var(--r); border: 1px solid rgba(255,51,102,.3); }
.icon-btn.delete:hover { background: rgba(255,51,102,.2); box-shadow: 0 0 10px rgba(255,51,102,.3); }

.add-btn {
  width: 100%; padding: 14px; background: linear-gradient(135deg, var(--g), #00cc6a);
  border: none; border-radius: 10px; color: #000;
  font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1rem;
  cursor: pointer; transition: all .3s; margin-bottom: 10px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
}
.add-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,255,136,.3); }
.add-btn.secondary {
  background: linear-gradient(135deg, var(--a), #0088cc);
  color: white;
}

/* === MODAL === */
.modal-overlay {
  display: none; position: fixed; inset: 0; z-index: 10001;
  background: rgba(0,0,0,.8); backdrop-filter: blur(5px);
  align-items: center; justify-content: center; padding: 20px;
}
.modal-overlay.active { display: flex; }
.modal {
  background: linear-gradient(145deg, var(--cd), var(--cd2));
  border: 2px solid var(--owner); border-radius: 20px;
  padding: 30px; width: 100%; max-width: 500px;
  max-height: 90vh; overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 40px var(--owner-glow);
  animation: modalIn 0.3s ease;
}
@keyframes modalIn {
  from { opacity: 0; transform: scale(0.9) translateY(20px); }
  to { opacity: 1; transform: none; }
}
.modal h3 {
  font-family: 'Orbitron', monospace; color: var(--owner);
  margin-bottom: 20px; text-align: center;
  text-shadow: 0 0 20px var(--owner-glow);
}
.form-group {
  margin-bottom: 15px;
}
.form-group label {
  display: block; font-size: 0.75rem; color: var(--dm);
  margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px;
  font-weight: 600;
}
.form-group input,
.form-group select,
.form-group textarea {
  width: 100%; padding: 12px 15px; background: var(--inp);
  border: 2px solid var(--bd); border-radius: 10px; color: var(--tx);
  font-family: 'Rajdhani', sans-serif; font-size: 1rem;
  outline: none; transition: all .3s;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  border-color: var(--owner); box-shadow: 0 0 20px var(--owner-glow);
}
.form-group textarea {
  min-height: 80px; resize: vertical;
}
.form-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
}
.dynamic-fields {
  background: rgba(0,0,0,.2); border-radius: 10px;
  padding: 15px; margin-bottom: 15px;
}
.dynamic-fields h4 {
  font-size: 0.8rem; color: var(--s); margin-bottom: 10px;
  display: flex; align-items: center; justify-content: space-between;
}
.field-row {
  display: flex; gap: 10px; margin-bottom: 8px; align-items: center;
}
.field-row input { flex: 1; }
.field-row button {
  padding: 8px 12px; background: var(--r); border: none;
  border-radius: 6px; color: white; cursor: pointer;
  font-size: 0.8rem;
}
.add-field-btn {
  padding: 8px 16px; background: rgba(0,255,136,.1);
  border: 1px dashed var(--g); border-radius: 8px;
  color: var(--g); font-size: 0.8rem; cursor: pointer;
  width: 100%; margin-top: 5px;
}
.modal-actions {
  display: flex; gap: 10px; margin-top: 20px;
}
.modal-actions button {
  flex: 1; padding: 14px; border: none; border-radius: 10px;
  font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1rem;
  cursor: pointer; transition: all .3s;
}
.modal-actions .save {
  background: linear-gradient(135deg, var(--g), #00cc6a); color: #000;
}
.modal-actions .save:hover {
  transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,255,136,.3);
}
.modal-actions .cancel {
  background: var(--bd); color: var(--tx);
}
.modal-actions .cancel:hover {
  background: var(--r); color: white;
}

/* === MAIN APP === */
#main-app {
  filter: blur(10px); pointer-events: none; opacity: 0.3;
  transition: all .5s ease;
}
#main-app.unlocked {
  filter: none; pointer-events: all; opacity: 1;
}

/* === RESTUL STILURILOR === */
#particles { position:fixed; inset:0; z-index:0; pointer-events:none }
body::before {
  content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    radial-gradient(ellipse at 10% 10%, rgba(255,107,53,.06) 0%, transparent 40%),
    radial-gradient(ellipse at 90% 20%, rgba(0,212,255,.05) 0%, transparent 40%),
    radial-gradient(ellipse at 50% 90%, rgba(255,215,0,.04) 0%, transparent 40%),
    radial-gradient(ellipse at 70% 50%, rgba(180,77,255,.03) 0%, transparent 40%);
}
body::after {
  content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
  background-image:
    linear-gradient(rgba(255,107,53,.012) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,212,255,.012) 1px, transparent 1px);
  background-size: 60px 60px;
}
.ct { max-width:1020px; margin:0 auto; padding:30px 20px; position:relative; z-index:1 }
.hd { text-align:center; margin-bottom:28px; position:relative; padding:30px 0 }
.hd::before {
  content:''; position:absolute; top:0; left:50%; transform:translateX(-50%);
  width:80px; height:3px;
  background: linear-gradient(90deg, transparent, var(--p), var(--s), var(--a), transparent);
}
.hd::after {
  content:''; position:absolute; bottom:0; left:50%; transform:translateX(-50%);
  width:60%; height:1px;
  background: linear-gradient(90deg, transparent, var(--bd), transparent);
}
.hd .logo {
  font-family: 'Orbitron', monospace; font-size: clamp(1.8rem,5vw,2.8rem);
  font-weight: 900; letter-spacing: 6px; text-transform: uppercase;
  background: linear-gradient(135deg, var(--p) 0%, var(--s) 40%, var(--a) 70%, var(--g) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 30px var(--glow-p));
  animation: logoGlow 4s ease-in-out infinite alternate;
}
@keyframes logoGlow {
  0% { filter: drop-shadow(0 0 20px var(--glow-p)) }
  50% { filter: drop-shadow(0 0 30px var(--glow-s)) }
  100% { filter: drop-shadow(0 0 20px var(--glow-a)) }
}
.hd .sub {
  font-family: 'JetBrains Mono', monospace; font-size: .8rem;
  color: var(--dm); letter-spacing: 4px; margin-top: 8px; text-transform: uppercase;
}
.hd .version {
  display: inline-block; margin-top:10px; padding: 4px 14px;
  background: linear-gradient(135deg, rgba(255,107,53,.15), rgba(0,212,255,.1));
  border: 1px solid rgba(255,107,53,.3); border-radius: 20px;
  font-family: 'JetBrains Mono', monospace; font-size: .65rem;
  color: var(--a); letter-spacing: 2px;
}
.br {
  display:flex; justify-content:center; align-items:center; gap:16px; flex-wrap:wrap;
  margin: 0 0 24px; padding: 14px 20px;
  background: linear-gradient(135deg, rgba(255,215,0,.08), rgba(255,107,53,.04), rgba(0,212,255,.04));
  border: 1px solid rgba(255,215,0,.25); border-radius: 14px;
  position:relative; overflow:hidden;
}
.br::before {
  content:''; position:absolute; top:0; left:0; width:100%; height:2px;
  background: linear-gradient(90deg, var(--p), var(--s), var(--a), var(--g));
}
.br::after {
  content:''; position:absolute; bottom:0; left:0; width:100%; height:1px;
  background: linear-gradient(90deg, transparent, rgba(255,215,0,.2), transparent);
}
.br .tag { color:var(--s); font-family:'Orbitron',monospace; font-weight:700; font-size:.85rem; letter-spacing:1px }
.br .sep { color:rgba(255,255,255,.15); font-size:.8rem }
.br a { color:var(--a); text-decoration:none; font-family:'JetBrains Mono',monospace; font-weight:700; font-size:.85rem; transition:.3s }
.br a:hover { color:var(--s); text-shadow:0 0 15px var(--glow-a) }
.br .ref { color:var(--g); font-family:'Orbitron',monospace; font-weight:700; font-size:.85rem }
.br .srv { color:var(--p); font-family:'Rajdhani',sans-serif; font-weight:700; font-size:.85rem; text-transform:uppercase; letter-spacing:2px }
.tabs {
  display:flex; gap:6px; flex-wrap:wrap; justify-content:center;
  margin-bottom:24px; padding:14px 12px;
  background: linear-gradient(180deg, var(--cd), var(--bg2));
  border: 1px solid var(--bd); border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,.3);
}
.tb {
  padding:11px 20px; font-family:'Rajdhani',sans-serif; font-size:.92rem; font-weight:700;
  border:2px solid var(--bd); border-radius:10px;
  background: var(--inp); color:var(--dm);
  cursor:pointer; transition:all .3s ease;
  display:flex; align-items:center; gap:6px; letter-spacing:.5px;
  position:relative; overflow:hidden;
}
.tb::before {
  content:''; position:absolute; bottom:0; left:50%; width:0; height:2px;
  background:var(--s); transition:all .3s; transform:translateX(-50%);
}
.tb:hover { border-color:var(--p); color:var(--tx); transform:translateY(-2px); box-shadow:0 4px 15px rgba(255,107,53,.15) }
.tb:hover::before { width:60% }
.tb.on {
  border-color:var(--s); color:var(--s);
  background: linear-gradient(135deg, rgba(255,215,0,.12), rgba(255,107,53,.06));
  box-shadow: 0 0 20px rgba(255,215,0,.2), inset 0 0 20px rgba(255,215,0,.05);
}
.tb.on::before { width:80%; background:var(--s) }
.pn { display:none; animation:panelIn .5s cubic-bezier(.22,1,.36,1) }
.pn.on { display:block }
@keyframes panelIn { from{opacity:0;transform:translateY(15px)} to{opacity:1;transform:none} }
.sc {
  background: linear-gradient(145deg, var(--cd), var(--cd2));
  border: 1px solid var(--bd); border-radius:16px;
  padding:24px; margin-bottom:18px;
  position:relative; overflow:hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,.2);
}
.sc::before {
  content:''; position:absolute; top:0; left:0; width:100%; height:3px;
  background: linear-gradient(90deg, var(--p), var(--s), var(--a));
}
.sc.hl { border-color: rgba(255,107,53,.4); box-shadow: 0 0 30px rgba(255,107,53,.1) }
.sc.gn { border-color: rgba(0,255,136,.3); box-shadow: 0 0 30px rgba(0,255,136,.08) }
.sc.gn::before { background: linear-gradient(90deg, var(--g), var(--a), var(--g)) }
.sc.vt { border-color: rgba(180,77,255,.3); box-shadow: 0 0 30px rgba(180,77,255,.08) }
.sc.vt::before { background: linear-gradient(90deg, var(--violet), var(--r), var(--violet)) }
.st {
  font-family: 'Orbitron', monospace; font-size: .85rem;
  color: var(--p); letter-spacing: 2px; text-align:center;
  font-weight: 700; text-transform: uppercase; margin-bottom:16px;
  text-shadow: 0 0 20px var(--glow-p);
}
.st.cyan { color:var(--a); text-shadow:0 0 20px var(--glow-a) }
.st.green { color:var(--g); text-shadow:0 0 20px var(--glow-g) }
.st.gold { color:var(--s); text-shadow:0 0 20px var(--glow-s) }
.ir { display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:20px }
.ig { display:flex; flex-direction:column; align-items:center; gap:8px }
.ig label {
  font-family:'JetBrains Mono',monospace; font-size:.72rem; font-weight:600;
  color:var(--a); letter-spacing:1.5px; text-transform:uppercase;
}
.ig input, .ig select {
  padding:14px 18px; font-family:'Orbitron',monospace; font-size:1.1rem; font-weight:700;
  text-align:center; background:var(--inp);
  border:2px solid rgba(0,212,255,.4); border-radius:12px;
  color:var(--a); outline:none; transition:all .3s; min-width:180px;
}
.ig input:focus, .ig select:focus {
  border-color:var(--s); box-shadow:0 0 30px var(--glow-a); color:var(--s);
}
.ig select option { background:var(--cd); color:var(--tx) }
.gr { display:grid; gap:14px; margin:14px 0 }
.g2 { grid-template-columns: repeat(auto-fit, minmax(190px, 1fr)) }
.g3 { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) }
.g4 { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)) }
.mc {
  background: linear-gradient(145deg, var(--cd), #0a0a16);
  border: 2px solid var(--bd); border-radius:14px;
  padding:20px 16px; text-align:center;
  transition: all .35s cubic-bezier(.22,1,.36,1);
  position:relative; overflow:hidden;
}
.mc::before { content:''; position:absolute; top:0; left:0; width:100%; height:3px }
.mc:hover { transform:translateY(-4px) }
.mc .ic { font-size:2.2rem; margin-bottom:8px; filter:drop-shadow(0 0 8px rgba(255,255,255,.2)) }
.mc .nm {
  font-family:'JetBrains Mono',monospace; font-size:.68rem;
  color:var(--dm); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:6px;
}
.mc .vl { font-family:'Orbitron',monospace; font-size:1.8rem; font-weight:900; transition:all .3s }
.mc .un { font-size:.68rem; color:var(--dm); margin-top:3px }
.mc.cu { border-color:var(--cu) }.mc.cu::before { background:linear-gradient(90deg,var(--cu),#d4956a) }.mc.cu .vl { color:var(--cu) }
.mc.cu:hover { box-shadow:0 8px 30px rgba(184,115,51,.25) }
.mc.lead { border-color:var(--pb) }.mc.lead::before { background:linear-gradient(90deg,var(--pb),#8a9bac) }.mc.lead .vl { color:var(--pb) }
.mc.lead:hover { box-shadow:0 8px 30px rgba(107,123,140,.25) }
.mc.gp { border-color:var(--gunp) }.mc.gp::before { background:linear-gradient(90deg,#555,var(--gunp)) }.mc.gp .vl { color:var(--gunp) }
.mc.gp:hover { box-shadow:0 8px 30px rgba(122,122,122,.2) }
.mc.gn { border-color:var(--g) }.mc.gn::before { background:var(--g) }.mc.gn .vl { color:var(--g) }
.mc.gn:hover { box-shadow:0 8px 30px var(--glow-g) }
.mc.gl { border-color:var(--s) }.mc.gl::before { background:var(--s) }.mc.gl .vl { color:var(--s) }
.mc.gl:hover { box-shadow:0 8px 30px var(--glow-s) }
.mc.rd { border-color:var(--r) }.mc.rd::before { background:var(--r) }.mc.rd .vl { color:var(--r) }
.mc.rd:hover { box-shadow:0 8px 30px rgba(255,51,102,.25) }
.mc.bl { border-color:var(--a) }.mc.bl::before { background:var(--a) }.mc.bl .vl { color:var(--a) }
.mc.bl:hover { box-shadow:0 8px 30px var(--glow-a) }
.mc.vt { border-color:var(--violet) }.mc.vt::before { background:var(--violet) }.mc.vt .vl { color:var(--violet) }
.mc.vt:hover { box-shadow:0 8px 30px rgba(180,77,255,.25) }
.sm {
  background: linear-gradient(135deg, #13132a, #0d0d1a);
  border: 2px solid var(--p); border-radius:16px;
  padding:24px; margin-top:18px; position:relative; overflow:hidden;
  box-shadow: 0 0 30px rgba(255,107,53,.08);
}
.sm::before {
  content:''; position:absolute; top:0; left:0; width:100%; height:4px;
  background: linear-gradient(90deg, var(--p), var(--s), var(--a), var(--g));
}
.sm-t {
  font-family:'Orbitron',monospace; font-size:.9rem;
  color:var(--p); letter-spacing:2px; text-align:center;
  text-transform:uppercase; font-weight:700; margin-bottom:16px;
}
.sg { display:grid; grid-template-columns:repeat(auto-fit, minmax(145px,1fr)); gap:12px }
.si {
  text-align:center; padding:16px 12px;
  background: rgba(255,107,53,.06); border-radius:12px;
  border: 1px solid rgba(255,107,53,.15); transition:all .3s;
}
.si:hover { background:rgba(255,107,53,.1); border-color:rgba(255,107,53,.35); transform:translateY(-2px) }
.si .lb {
  font-family:'JetBrains Mono',monospace; font-size:.62rem;
  color:var(--dm); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:5px;
}
.si .sv { font-family:'Orbitron',monospace; font-size:1.15rem; font-weight:900; color:var(--p) }
.si .sv.gl { color:var(--s) } .si .sv.gn { color:var(--g) }
.rc {
  margin-top:14px; padding:14px;
  background: rgba(255,255,255,.02); border-radius:10px;
  border: 1px dashed rgba(255,215,0,.2);
  text-align:center; color:var(--dm); font-size:.85rem; line-height:1.7;
}
.rc b { color:var(--s); font-weight:700 }
.bs { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:12px 0 }
.bt {
  padding:14px 20px; font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:700;
  border:2px solid var(--bd); border-radius:12px;
  background:var(--inp); color:var(--dm);
  cursor:pointer; transition:all .3s;
  display:flex; flex-direction:column; align-items:center; gap:4px;
  position:relative; overflow:hidden;
}
.bt::after {
  content:''; position:absolute; bottom:0; left:0; width:100%; height:2px;
  background:var(--s); transform:scaleX(0); transition:.3s;
}
.bt:hover { border-color:var(--p); color:var(--tx); transform:translateY(-3px) }
.bt:hover::after { transform:scaleX(.5) }
.bt.on {
  border-color:var(--s); color:var(--s);
  background: linear-gradient(135deg, rgba(255,215,0,.15), rgba(255,107,53,.06));
  box-shadow: 0 0 20px rgba(255,215,0,.2);
}
.bt.on::after { transform:scaleX(.8) }
.bt small { font-family:'JetBrains Mono',monospace; font-size:.65rem; opacity:.6 }
.ib {
  padding:11px 16px; background:rgba(0,212,255,.05);
  border:1px solid rgba(0,212,255,.15); border-radius:10px;
  text-align:center; color:var(--a);
  font-family:'JetBrains Mono',monospace; font-size:.78rem; margin:10px 0;
}
table { width:100%; border-collapse:collapse; margin:12px 0 }
th, td { padding:11px 10px; text-align:left; border-bottom:1px solid rgba(255,255,255,.05); font-size:.82rem }
th {
  font-family:'JetBrains Mono',monospace; color:var(--a); font-weight:600;
  text-transform:uppercase; letter-spacing:1.5px; font-size:.68rem;
  background: rgba(0,212,255,.04); border-bottom:2px solid rgba(0,212,255,.15);
}
td { color:var(--tx) }
tr:hover td { background:rgba(255,107,53,.03) }
td b { color:var(--s) }
.cat-badge {
  display:inline-block; padding:3px 10px; border-radius:6px;
  font-family:'JetBrains Mono',monospace; font-size:.65rem;
  font-weight:600; letter-spacing:1px; text-transform:uppercase;
}
.cat-badge.pistol { background:rgba(0,212,255,.1); color:var(--a); border:1px solid rgba(0,212,255,.3) }
.cat-badge.smg { background:rgba(0,255,136,.1); color:var(--g); border:1px solid rgba(0,255,136,.3) }
.cat-badge.rifle { background:rgba(255,107,53,.1); color:var(--p); border:1px solid rgba(255,107,53,.3) }
.cat-badge.shotgun { background:rgba(255,51,102,.1); color:var(--r); border:1px solid rgba(255,51,102,.3) }
.cat-badge.heavy { background:rgba(255,215,0,.1); color:var(--s); border:1px solid rgba(255,215,0,.3) }
.cat-badge.mg { background:rgba(180,77,255,.1); color:var(--violet); border:1px solid rgba(180,77,255,.3) }
.cat-badge.special { background:rgba(255,255,255,.05); color:var(--tx); border:1px solid rgba(255,255,255,.15) }
.cat-groups { display:flex; gap:10px; justify-content:center; margin-bottom:8px }
.cat-group-btn {
  flex:1; max-width:300px; padding:16px 24px; text-align:center;
  font-family:'Orbitron',monospace; font-size:.9rem; font-weight:800;
  letter-spacing:2px; text-transform:uppercase;
  border:2px solid var(--bd); border-radius:14px;
  background: linear-gradient(145deg, var(--cd), var(--cd2));
  color: var(--dm); cursor:pointer; transition:all .4s;
  position:relative; overflow:hidden;
}
.cat-group-btn::before {
  content:''; position:absolute; top:0; left:0; width:100%; height:3px;
  background: linear-gradient(90deg, transparent, var(--bd), transparent);
  transition:all .4s;
}
.cat-group-btn:hover { transform:translateY(-3px); border-color:rgba(255,255,255,.2) }
.cat-group-btn.mafie.on {
  border-color: var(--r); color: var(--r);
  background: linear-gradient(145deg, rgba(255,51,102,.12), rgba(180,77,255,.06));
  box-shadow: 0 0 30px rgba(255,51,102,.15), inset 0 0 30px rgba(255,51,102,.04);
}
.cat-group-btn.mafie.on::before { background: linear-gradient(90deg, var(--r), var(--violet), var(--r)) }
.cat-group-btn.legal.on {
  border-color: var(--g); color: var(--g);
  background: linear-gradient(145deg, rgba(0,255,136,.1), rgba(0,212,255,.05));
  box-shadow: 0 0 30px rgba(0,255,136,.12), inset 0 0 30px rgba(0,255,136,.03);
}
.cat-group-btn.legal.on::before { background: linear-gradient(90deg, var(--g), var(--a), var(--g)) }
.cat-group-btn .cg-icon { font-size:1.4rem; display:block; margin-bottom:4px }
.cat-group-btn .cg-sub {
  font-family:'JetBrains Mono',monospace; font-size:.55rem;
  color: var(--dm); letter-spacing:1px; margin-top:4px; font-weight:400;
}
.cat-panel { display:none; animation:panelIn .5s cubic-bezier(.22,1,.36,1) }
.cat-panel.on { display:block }
.sub-tabs {
  display:flex; gap:6px; flex-wrap:wrap; justify-content:center;
  margin-bottom:22px; padding:12px 10px;
  background: linear-gradient(180deg, rgba(16,16,28,.8), rgba(6,6,16,.6));
  border: 1px solid var(--bd); border-radius:14px;
}
.sub-tabs.mafie { border-color:rgba(255,51,102,.15); box-shadow:0 2px 15px rgba(255,51,102,.05) }
.sub-tabs.legal { border-color:rgba(0,255,136,.15); box-shadow:0 2px 15px rgba(0,255,136,.05) }
.ft {
  text-align:center; padding:28px 20px; color:var(--dm); font-size:.78rem;
  border-top:1px solid var(--bd); margin-top:28px; position:relative;
}
.ft::before {
  content:''; position:absolute; top:0; left:50%; transform:translateX(-50%);
  width:40%; height:1px;
  background:linear-gradient(90deg, transparent, var(--p), transparent);
}
.ft b { color:var(--p) } .ft a { color:var(--a); text-decoration:none }
.ft .copy { font-family:'JetBrains Mono',monospace; font-size:.6rem; color:#333; margin-top:12px; letter-spacing:2px }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }
.up { animation: pulse .3s ease }
@media (max-width:680px) {
  .ct { padding:20px 12px }
  .tb { padding:9px 14px; font-size:.8rem }
  .mc .vl { font-size:1.4rem }
  .ig input, .ig select { min-width:140px; font-size:.95rem }
  .bt { padding:11px 15px; font-size:.9rem }
  .br { gap:10px; padding:10px 14px }
  .hd .logo { letter-spacing:3px }
  #admin-panel { width: calc(100% - 40px); right: 20px; left: 20px; }
  .form-row { grid-template-columns: 1fr; }
}


/* === ENHANCED LOGIN === */
.login-lock-icon {
  font-size: 3.5rem; margin-bottom: 10px;
  filter: drop-shadow(0 0 20px rgba(88,101,242,.4));
  animation: lockPulse 3s ease-in-out infinite;
}
@keyframes lockPulse {
  0%, 100% { filter: drop-shadow(0 0 20px rgba(88,101,242,.4)); transform: scale(1); }
  50% { filter: drop-shadow(0 0 35px rgba(88,101,242,.6)); transform: scale(1.05); }
}
.owner-login-btn {
  display: inline-flex; align-items: center; gap: 10px;
  padding: 14px 30px;
  background: linear-gradient(135deg, #dc2626, #b91c1c);
  border: 2px solid rgba(255,0,0,.4);
  border-radius: 12px; color: white;
  font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 700;
  cursor: pointer; transition: all .3s;
  box-shadow: 0 6px 25px rgba(255,0,0,.25);
  width: 80%; margin: 0 auto;
  justify-content: center;
  animation: ownerPulse 2.5s ease-in-out infinite;
}
@keyframes ownerPulse {
  0%, 100% { box-shadow: 0 6px 25px rgba(255,0,0,.25); }
  50% { box-shadow: 0 6px 35px rgba(255,0,0,.4), 0 0 15px rgba(255,0,0,.2); }
}
.owner-login-btn:hover {
  transform: translateY(-3px); box-shadow: 0 10px 40px rgba(255,0,0,.4);
}
.login-separator {
  display: flex; align-items: center; gap: 15px;
  margin: 18px 0; color: var(--dm); font-size: .75rem;
  text-transform: uppercase; letter-spacing: 2px;
}
.login-separator::before, .login-separator::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, transparent, var(--bd), transparent);
}
.login-footer-text {
  margin-top: 25px; padding-top: 18px;
  border-top: 1px solid rgba(255,255,255,.04);
  color: var(--dm); font-size: .8rem; line-height: 1.7;
}
.pending-box.denied { background: rgba(255,51,102,.08); border-color: rgba(255,51,102,.25); }
.pending-box.denied::before { background: linear-gradient(90deg, var(--r), #cc0033, var(--r)); }
.pending-box.denied h3 { color: var(--r); }
.pending-box.blacklisted { background: rgba(100,0,0,.15); border-color: rgba(255,0,0,.4); }
.pending-box.blacklisted::before { background: linear-gradient(90deg, #ff0000, #880000, #ff0000); }
.pending-box.blacklisted h3 { color: #ff0000; }
.member-badge {
  display: inline-block; background: linear-gradient(135deg, #5865F2, #4752C4);
  color: white; padding: 4px 12px; border-radius: 20px;
  font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
}
.admin-badge-tag {
  display: inline-block; background: linear-gradient(135deg, var(--s), #cc9900);
  color: #000; padding: 4px 12px; border-radius: 20px;
  font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
}

/* === ADMIN TABS === */
.admin-tabs {
  display: flex; gap: 4px; margin-bottom: 15px;
  background: rgba(0,0,0,.2); border-radius: 10px; padding: 4px;
}
.admin-tab {
  flex: 1; padding: 10px 8px; text-align: center;
  background: transparent; border: none; border-radius: 8px;
  color: var(--dm); font-family: 'Rajdhani', sans-serif;
  font-weight: 700; font-size: .78rem; cursor: pointer; transition: all .3s;
}
.admin-tab:hover { color: var(--tx); background: rgba(255,255,255,.03); }
.admin-tab.active {
  background: linear-gradient(135deg, rgba(255,0,0,.15), rgba(255,0,0,.05));
  color: var(--owner); box-shadow: 0 0 15px var(--owner-glow);
}
.admin-section { display: none; }
.admin-section.active { display: block; }

/* === MEMBER LIST === */
.member-list { display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; }
.member-item {
  display: flex; align-items: center; gap: 12px;
  padding: 12px; background: rgba(0,0,0,.2); border-radius: 12px;
  border: 1px solid var(--bd); transition: all .3s;
}
.member-item:hover { border-color: rgba(255,255,255,.1); background: rgba(0,0,0,.3); }
.member-item.pending-item { border-color: rgba(255,193,7,.3); background: rgba(255,193,7,.03); }
.member-item.blacklisted-item { border-color: rgba(255,0,0,.5); background: rgba(255,0,0,.08); opacity: .7; }
.member-item.restricted-item { border-color: rgba(255,51,102,.3); }
.member-item.admin-item { border-color: rgba(255,215,0,.3); }
.member-item.expired-item { opacity: .7; }
.member-avatar { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--bd); }
.member-info { flex: 1; min-width: 0; }
.member-name { font-weight: 700; font-size: .85rem; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
.member-meta { font-size: .65rem; color: var(--dm); font-family: 'JetBrains Mono', monospace; margin-top: 2px; }
.member-status {
  display: inline-block; padding: 2px 8px; border-radius: 6px;
  font-size: .55rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
}
.member-status.active { background: rgba(0,255,136,.15); color: var(--g); }
.member-status.pending { background: rgba(255,193,7,.15); color: #ffc107; }
.member-status.expired { background: rgba(107,107,138,.15); color: var(--dm); }
.member-status.blacklisted { background: rgba(255,0,0,.2); color: #ff0000; }
.member-status.restricted { background: rgba(255,51,102,.15); color: var(--r); }
.member-status.admin-status { background: rgba(255,215,0,.15); color: var(--s); }
.member-actions { display: flex; gap: 4px; flex-wrap: wrap; justify-content: flex-end; }
.m-action-btn {
  padding: 4px 8px; border: none; border-radius: 5px;
  font-size: .6rem; font-weight: 700; cursor: pointer; transition: all .2s;
  font-family: 'Rajdhani', sans-serif;
}
.m-action-btn:hover { transform: translateY(-1px); }
.m-action-btn.approve { background: rgba(0,255,136,.15); color: var(--g); border: 1px solid rgba(0,255,136,.3); }
.m-action-btn.restrict { background: rgba(255,51,102,.1); color: var(--r); border: 1px solid rgba(255,51,102,.3); }
.m-action-btn.blacklist { background: rgba(255,0,0,.15); color: #ff0000; border: 1px solid rgba(255,0,0,.3); }
.m-action-btn.delete { background: rgba(107,107,138,.1); color: var(--dm); border: 1px solid rgba(107,107,138,.3); }
.m-action-btn.make-admin { background: rgba(255,215,0,.1); color: var(--s); border: 1px solid rgba(255,215,0,.3); }
.m-action-btn.reactivate { background: rgba(0,212,255,.1); color: var(--a); border: 1px solid rgba(0,212,255,.3); }
.member-expiry { font-size: .6rem; color: var(--dm); margin-top: 2px; font-family: 'JetBrains Mono', monospace; }
.member-expiry.expired { color: var(--r); }
.member-expiry.expiring-soon { color: #ffc107; }
.admin-search {
  width: 100%; padding: 10px 14px; background: var(--inp);
  border: 2px solid var(--bd); border-radius: 10px;
  color: var(--tx); font-family: 'Rajdhani', sans-serif;
  font-size: .85rem; outline: none; transition: all .3s; margin-bottom: 8px;
}
.admin-search:focus { border-color: var(--owner); box-shadow: 0 0 15px var(--owner-glow); }
.admin-filter-row { display: flex; gap: 4px; margin-bottom: 8px; flex-wrap: wrap; }
.admin-filter-btn {
  padding: 5px 10px; background: var(--inp); border: 1px solid var(--bd);
  border-radius: 6px; color: var(--dm); font-size: .65rem; font-weight: 700;
  cursor: pointer; transition: all .2s; font-family: 'Rajdhani', sans-serif;
}
.admin-filter-btn:hover { border-color: var(--owner); color: var(--tx); }
.admin-filter-btn.active { background: rgba(255,0,0,.1); border-color: var(--owner); color: var(--owner); }

/* Admin Tabs */
.admin-tabs {
  display: flex; gap: 6px; margin-bottom: 15px; flex-wrap: wrap;
}
.admin-tab {
  padding: 8px 14px; background: var(--inp); border: 1px solid var(--bd);
  border-radius: 8px; color: var(--dm); font-size: 0.75rem; font-weight: 700;
  cursor: pointer; transition: all .3s; font-family: 'Rajdhani', sans-serif;
}
.admin-tab:hover { border-color: var(--owner); color: var(--tx); }
.admin-tab.active {
  background: linear-gradient(135deg, rgba(255,0,0,.15), rgba(255,0,0,.05));
  border-color: var(--owner); color: var(--owner);
  box-shadow: 0 0 15px var(--owner-glow);
}
.admin-section {
  display: none;
}
.admin-section.active {
  display: block;
}

/* Calculator List Styles */
.calculator-list {
  display: flex;
  flex-direction: column;
  gap: 10px; margin-top: 15px;
}
.calculator-item {
  display: flex; flex-direction: column;
  padding: 15px; background: rgba(0,0,0,.2);
  border: 1px solid var(--bd); border-radius: 10px;
  transition: all .3s;
}
.calculator-item:hover { border-color: var(--owner); background: rgba(255,0,0,.05); }
.calculator-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 10px;
}
.calculator-name {
  font-weight: 700; color: var(--tx); font-size: 1rem;
  font-family: 'Orbitron', monospace;
}
.calculator-icon { font-size: 1.5rem; margin-right: 10px; }
.calculator-meta {
  font-size: 0.7rem; color: var(--dm); margin-bottom: 8px;
  font-family: 'JetBrains Mono', monospace;
}
.calculator-inputs {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 6px; margin-bottom: 10px;
  padding: 10px; background: rgba(0,0,0,.15);
  border-radius: 8px;
}
.calculator-input-badge {
  padding: 4px 8px; background: rgba(0,212,255,.1);
  border: 1px solid rgba(0,212,255,.3); border-radius: 6px;
  font-size: 0.7rem; color: var(--a); font-weight: 600;
}
.calculator-outputs {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 6px;
  padding: 10px; background: rgba(0,255,136,.05);
  border-radius: 8px;
}
.calculator-output-badge {
  padding: 4px 8px; background: rgba(0,255,136,.1);
  border: 1px solid rgba(0,255,136,.3); border-radius: 6px;
  font-size: 0.7rem; color: var(--g); font-weight: 600;
}

@keyframes slideIn { from{transform:translateX(100px);opacity:0} to{transform:none;opacity:1} }
@keyframes slideOut { from{transform:none;opacity:1} to{transform:translateX(100px);opacity:0} }

/* Anti-source protection */
input, textarea, select { -webkit-user-select: text !important; -moz-user-select: text !important; user-select: text !important; }

</style>
<noscript><meta http-equiv="refresh" content="0;url=about:blank"></noscript>
</head>
<body style="-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;" oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;">

<canvas id="particles"></canvas>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-box" id="login-box">
    <div id="login-content">
      <div class="login-lock-icon">üîê</div>
      <div class="login-logo">ACCES<br>RESTRICTIONAT</div>
      <div class="login-sub">Autentificare necesara pentru Craft Roleplay Calculator</div>
      
      <button class="discord-btn" onclick="loginWithDiscord()" style="width:100%;justify-content:center;">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
        Conectare cu Discord
      </button>
      
      <div class="login-separator">sau</div>
      
      <button class="owner-login-btn" onclick="loginOwner()">
        üëë Login OWNER
      </button>

      <div class="login-footer-text">
        üîí Doar membrii aprobati pot accesa calculatorul.<br>
        Solicitarea ta va fi revizuita de un administrator.
      </div>
    </div>

    <div id="pending-content" style="display: none;">
      <div class="user-info">
        <img src="" alt="Avatar" class="user-avatar" id="pending-avatar">
        <div class="user-details">
          <div class="user-name" id="pending-name">Username</div>
          <div class="user-id" id="pending-id">ID: 000000000</div>
        </div>
      </div>
      <div class="pending-box" id="pending-box">
        <h3 id="pending-title">‚è≥ ASTEPTARE APROBARE</h3>
        <p id="pending-message">Cererea ta de acces a fost trimisa.</p>
      </div>
      <button class="discord-btn" style="margin-top: 15px; background: linear-gradient(135deg, var(--dm), #555); width:100%; justify-content:center;" onclick="logout()">
        Deconectare
      </button>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<button class="admin-btn" id="admin-toggle" onclick="toggleAdmin()" style="display: none;">
  üëë OWNER Panel
</button>
<div id="admin-panel">
  <h3>üëë Panou OWNER</h3>
  <div class="stats">
    <div class="stat-box"><div class="num" id="stat-total" style="color:var(--owner)">0</div><div class="lbl">Total</div></div>
    <div class="stat-box"><div class="num" id="stat-active" style="color:var(--g)">0</div><div class="lbl">Activi</div></div>
    <div class="stat-box"><div class="num" id="stat-pending" style="color:#ffc107">0</div><div class="lbl">Asteptare</div></div>
    <div class="stat-box"><div class="num" id="stat-blacklisted" style="color:var(--r)">0</div><div class="lbl">Blacklist</div></div>
  </div>
  <div style="margin-bottom:12px;font-size:.8rem;color:var(--dm);">üëë OWNER: <span id="admin-name" style="color:var(--owner);font-weight:700;"></span></div>

  <div class="admin-tabs">
    <button class="admin-tab active" onclick="switchAdminTab('members', this)">üë• Membri</button>
    <button class="admin-tab" onclick="switchAdminTab('categories', this)">üìÅ Categorii</button>
    <button class="admin-tab" onclick="switchAdminTab('subcategories', this)">üìÇ Subcategorii</button>
    <button class="admin-tab" onclick="switchAdminTab('data', this)">üì¶ Date</button>
    <button class="admin-tab" onclick="switchAdminTab('tools', this)">üîß Unelte</button>
    <button class="admin-tab" onclick="switchAdminTab('calculators', this)">üìä Calculatoare</button>
  </div>

  <div class="admin-section active" id="admin-members">
    <input type="text" class="admin-search" placeholder="üîç Cauta membru dupa nume sau ID..." oninput="filterMembers(this.value)">
    <div class="admin-filter-row">
      <button class="admin-filter-btn active" onclick="setMemberFilter('all',this)">Toti</button>
      <button class="admin-filter-btn" onclick="setMemberFilter('active',this)">Activi</button>
      <button class="admin-filter-btn" onclick="setMemberFilter('pending',this)">Asteptare</button>
      <button class="admin-filter-btn" onclick="setMemberFilter('expired',this)">Expirat</button>
      <button class="admin-filter-btn" onclick="setMemberFilter('restricted',this)">Restrict</button>
      <button class="admin-filter-btn" onclick="setMemberFilter('blacklisted',this)">Blacklist</button>
    </div>
    <div class="member-list" id="member-list"></div>
  </div>

  <div class="admin-section" id="admin-categories">
    <button class="add-btn secondary" onclick="openCategoryModal()">‚ûï Adauga Categorie Noua</button>
    <div class="category-list" id="category-list"></div>
  </div>

  <div class="admin-section" id="admin-subcategories">
    <button class="add-btn secondary" onclick="openSubcategoryModal()">‚ûï Adauga Subcategorie Noua</button>
    <div class="category-list" id="subcategory-list"></div>
  </div>

  <div class="admin-section" id="admin-data">
    <div class="category-tabs" id="data-categories"></div>
    <button class="add-btn" onclick="openAddModal()">‚ûï Adauga Intrare Noua</button>
    <div class="data-list" id="data-list"></div>
  </div>

  <div class="admin-section" id="admin-tools">
    <button onclick="exportData()" style="width:100%;margin-top:8px;padding:10px;background:linear-gradient(135deg,var(--a),#0088cc);border:none;border-radius:8px;color:white;font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;">üíæ Exporta Date (Backup)</button>
    <button onclick="importData()" style="width:100%;margin-top:8px;padding:10px;background:linear-gradient(135deg,var(--g),#00cc6a);border:none;border-radius:8px;color:#000;font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;">üì• Importa Date (Restore)</button>
    <input type="file" id="import-file" style="display:none;" accept=".json" onchange="handleImport(event)">
    <button onclick="exportMembers()" style="width:100%;margin-top:8px;padding:10px;background:linear-gradient(135deg,var(--s),#cc9900);border:none;border-radius:8px;color:#000;font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;">üë• Exporta Membri</button>
    <button onclick="clearExpiredMembers()" style="width:100%;margin-top:8px;padding:10px;background:linear-gradient(135deg,var(--r),#cc0033);border:none;border-radius:8px;color:white;font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;">üóëÔ∏è Sterge Membri Expirat</button>
  </div>

  <div class="admin-section" id="admin-calculators">
    <button class="add-btn" onclick="openCalculatorModal()">‚ûï Adauga Calculator Nou</button>
    <div class="calculator-list" id="calculator-list"></div>
  </div>

  <button onclick="toggleAdmin()" style="width:100%;margin-top:12px;padding:10px;background:var(--bd);border:none;border-radius:8px;color:var(--tx);font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;">‚úï Inchide Panoul</button>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal">
    <h3 id="modal-title">Adauga</h3>
    <div id="modal-content"></div>
    <div class="modal-actions">
      <button class="save" onclick="saveData()">Salveaza</button>
      <button class="cancel" onclick="closeModal()">Anuleaza</button>
    </div>
  </div>
</div>

<!-- RESTRICT MODAL -->
<div class="modal-overlay" id="restrict-modal">
  <div class="modal">
    <h3>‚õî Restrictionare Membru</h3>
    <div id="restrict-content"></div>
    <div class="modal-actions">
      <button class="save" onclick="confirmRestrict()" style="background:linear-gradient(135deg,var(--r),#cc0033);color:white;">Aplica Restrictie</button>
      <button class="cancel" onclick="closeRestrictModal()">Anuleaza</button>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="main-app">
  <div class="ct">

  <header class="hd">
    <div class="logo">CRAFT ROLEPLAY</div>
    <div class="sub">Calculator Profesional ‚Äî B-Zone V</div>
    <div class="version">v3.0 ‚Äî 2026 EDITION</div>
  </header>

  <div class="br" style="justify-content: space-between;">
    <div style="display: flex; align-items: center; gap: 10px;">
      <img id="user-avatar" src="" style="width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--owner); box-shadow: 0 0 10px var(--owner-glow);">
      <div>
        <div style="font-size: 0.75rem; color: var(--dm);">Bine ai venit,</div>
        <div id="user-display-name" style="font-weight: 700; color: var(--owner); font-family: 'Orbitron', monospace; text-shadow: 0 0 10px var(--owner-glow);"></div>
        <div id="user-role-badge" style="font-size: 0.65rem; margin-top: 2px;"></div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;">
      <div id="user-expiry-info" style="font-size:.7rem;color:var(--dm);font-family:'JetBrains Mono',monospace;"></div>
      <button onclick="logout()" style="padding: 8px 16px; background: rgba(255,0,0,.1); border: 1px solid rgba(255,0,0,.3); border-radius: 8px; color: var(--owner); font-family: 'Rajdhani', sans-serif; font-weight: 700; cursor: pointer; font-size: 0.85rem; transition: all .3s;" onmouseover="this.style.background='rgba(255,0,0,.2)'" onmouseout="this.style.background='rgba(255,0,0,.1)'">Deconectare</button>
    </div>
  </div>

  <div class="br">
    <span class="tag">üéÆ COD 5% ROBERTO</span>
    <span class="sep">‚Ä¢</span>
    <a href="http://v.b-zone.ro" target="_blank">v.b-zone.ro</a>
    <span class="sep">‚Ä¢</span>
    <span class="ref">REF 6218</span>
    <span class="sep">‚Ä¢</span>
    <span class="srv">üåê Server B-ZONE</span>
  </div>

  <div class="cat-groups" id="main-categories"></div>
  <div id="dynamic-panels"></div>

  <footer class="ft">
    <p>Calculator pentru server <b>B-ZONE V</b> ‚Äî GTA 5 RolePlay</p>
    <p style="margin-top:8px">üéÆ <b>COD 5% ROBERTO</b> | <a href="http://v.b-zone.ro">v.b-zone.ro</a> | <b>REF 6218</b></p>
    <p class="copy">CRAFT ROLEPLAY 2026 ‚Äî TOATE DREPTURILE REZERVATE</p>
  </footer>

  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  PROTECTIE SOURCE CODE  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

// Blocheaza right-click
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
  showNotification('üö´ Click dreapta este dezactivat!');
  return false;
});

// Blocheaza combinatii de taste pentru view source / devtools
document.addEventListener('keydown', function(e) {
  // F12
  if (e.key === 'F12' || e.keyCode === 123) {
    e.preventDefault();
    showNotification('üö´ Accesul la DevTools este restrictionat!');
    return false;
  }
  // Ctrl+Shift+I (DevTools)
  if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.keyCode === 73)) {
    e.preventDefault();
    showNotification('üö´ Accesul la DevTools este restrictionat!');
    return false;
  }
  // Ctrl+Shift+J (Console)
  if (e.ctrlKey && e.shiftKey && (e.key === 'J' || e.key === 'j' || e.keyCode === 74)) {
    e.preventDefault();
    return false;
  }
  // Ctrl+Shift+C (Element Inspector)
  if (e.ctrlKey && e.shiftKey && (e.key === 'C' || e.key === 'c' || e.keyCode === 67)) {
    e.preventDefault();
    return false;
  }
  // Ctrl+U (View Source)
  if (e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.keyCode === 85)) {
    e.preventDefault();
    showNotification('üö´ Vizualizarea sursei este restrictionata!');
    return false;
  }
  // Ctrl+S (Save Page)
  if (e.ctrlKey && (e.key === 's' || e.key === 'S' || e.keyCode === 83)) {
    e.preventDefault();
    showNotification('üö´ Salvarea paginii este dezactivata!');
    return false;
  }
  // Ctrl+Shift+U (View Source Firefox)
  if (e.ctrlKey && e.shiftKey && (e.key === 'U' || e.key === 'u')) {
    e.preventDefault();
    return false;
  }
});

// Blocheaza selectarea textului si drag
document.addEventListener('selectstart', function(e) {
  // Permite selectarea in input-uri si textarea
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return true;
  e.preventDefault();
  return false;
});

document.addEventListener('dragstart', function(e) {
  e.preventDefault();
  return false;
});

// Detectare DevTools prin dimensiune fereastra
(function() {
  const threshold = 160;
  let devtoolsOpen = false;
  
  function checkDevTools() {
    const widthDiff = window.outerWidth - window.innerWidth > threshold;
    const heightDiff = window.outerHeight - window.innerHeight > threshold;
    
    if ((widthDiff || heightDiff) && !devtoolsOpen) {
      devtoolsOpen = true;
      document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#060610;color:#ff3366;font-family:Orbitron,monospace;font-size:1.5rem;text-align:center;padding:40px;"><div>üö´ ACCES INTERZIS<br><br><span style="font-size:.8rem;color:#6b6b8a;">Inspectarea codului sursa este restrictionata.<br>Inchide DevTools pentru a continua.</span></div></div>';
    }
    if (!widthDiff && !heightDiff && devtoolsOpen) {
      devtoolsOpen = false;
      location.reload();
    }
  }
  
  setInterval(checkDevTools, 1000);
  
  // Anti-debugging: detecteaza debugger
  (function antiDebug() {
    const start = performance.now();
    debugger;
    const end = performance.now();
    if (end - start > 100) {
      document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#060610;color:#ff3366;font-family:Orbitron,monospace;font-size:1.5rem;text-align:center;padding:40px;"><div>üö´ DEBUGGING DETECTAT<br><br><span style="font-size:.8rem;color:#6b6b8a;">Accesul este restrictionat.</span></div></div>';
    }
  })();
  
  // Console clear & warning
  console.clear();
  console.log('%c‚õî STOP!', 'color:red;font-size:60px;font-weight:bold;');
  console.log('%cAccesul la codul sursa al acestei pagini este RESTRICTIONAT.', 'color:#ff6b35;font-size:16px;');
  console.log('%cOrice tentativa de copiere sau inspectare este monitorizata.', 'color:#6b6b8a;font-size:12px;');
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  CONFIGURATIE OWNER & DISCORD  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const OWNER_ID = '1077872559422439444';
const DISCORD_CONFIG = {
  CLIENT_ID: '1461666992023928998',
  REDIRECT_URI: 'https://robertodeveloper91.github.io/craft-b-zone-roleplay',
  SCOPE: 'identify'
};
const ACCESS_DURATION_DAYS = 31;
const ACCESS_DURATION_MS = ACCESS_DURATION_DAYS * 24 * 60 * 60 * 1000;

const DEFAULT_CATEGORIES = [
  { id: 'mafie', name: 'CRAFT MAFIE', icon: 'üî´', sub: 'Cocaina ‚Ä¢ Gloante ‚Ä¢ Arme ‚Ä¢ Componente', color: 'mafie' },
  { id: 'legal', name: 'CRAFT LEGAL', icon: 'üî®', sub: 'Masa Craft ‚Ä¢ Locatii', color: 'legal' }
];

const DEFAULT_SUBCATEGORIES = {
  mafie: [
    { id: 'cocaina', name: 'Cocaina', icon: 'üíé', type: 'calculator' },
    { id: 'gloante', name: 'Gloante', icon: 'üéØ', type: 'calculator' },
    { id: 'arme', name: 'Arme', icon: 'üî´', type: 'calculator' },
    { id: 'componente', name: 'Componente', icon: '‚öôÔ∏è', type: 'table' }
  ],
  legal: [
    { id: 'masa', name: 'Masa Craft', icon: 'üî®', type: 'table' },
    { id: 'locatii', name: 'Locatii', icon: 'üìç', type: 'cards' }
  ]
};

const DEFAULT_DATA = {
  MUNITIE: {
    "9mm": { gpc:30, cu:1, pb:1, pr:1, ret:"1 Cupru + 1 Plumb + 1 Praf de Pusca = 30 gloante", cat:"Pistol / SMG" },
    "7.62mm": { gpc:30, cu:2, pb:2, pr:2, ret:"2 Cupru + 2 Plumb + 2 Praf de Pusca = 30 gloante", cat:"Rifle / MG" },
    "7.65mm": { gpc:20, cu:2, pb:2, pr:2, ret:"2 Cupru + 2 Plumb + 2 Praf de Pusca = 20 gloante", cat:"Special (Navy)" },
    ".38 Magnum": { gpc:20, cu:2, pb:2, pr:3, ret:"2 Cupru + 2 Plumb + 3 Praf de Pusca = 20 gloante", cat:"Revolver / Shotgun" },
  },
  ARME: {
    "Combat Pistol": { mun:"9mm", piese:{"Piese Arme":1,"Teava Pistol":1,"Corp Pistol":1}, cat:"Pistol" },
    "Machine Pistol": { mun:"9mm", piese:{"Piese Arme":1,"Teava Pistol":1,"Corp Pistol":1,"Teava SMG":1}, cat:"Pistol" },
    "Micro SMG": { mun:"9mm", piese:{"Piese Arme":1,"Teava SMG":1,"Corp SMG":1,"Teava Rifle":1,"Butstock":1}, cat:"SMG" },
    "SMG MK2": { mun:"9mm", piese:{"Piese Arme":1,"Teava SMG":1,"Corp SMG":1,"Teava Rifle":1,"Butstock":1}, cat:"SMG" },
    "(DB)": { mun:".38 Magnum", piese:{"Piese Arme":1,"Teava Pistol":1,"Corp Pistol":1,"Teava Rifle":1,"Corp Rifle":1,"Butstock":1,"Blueprint":1,"Lingou Aur":1}, cat:"Shotgun" },
    "(AK)": { mun:"7.62mm", piese:{"Piese Arme":3,"Teava Rifle":1,"Corp Rifle":1,"Butstock":1,"Teava SMG":1,"Corp SMG":1,"Teava Pistol":1,"Corp Pistol":1,"Blueprint":1}, cat:"Rifle" },
  },
  COMP: {
    "Piese de Arme": { mat:{"Arc":"1x Arc","Otel":"1x Otel","Plastic":"1x Plastic","Scrap":"2x Scrap"}, desc:"Componenta de baza pentru orice arma" },
    "Arc": { mat:{"Fier":"1x Fier","Carbune":"1x Carbune"}, desc:"Arc metalic pentru mecanisme" },
    "Plumb": { mat:{"Aluminiu":"1x Aluminiu","Plumb Brut":"4x Plumb"}, desc:"Plumb pentru munitie" },
  },
  MATARME: {
    "Teava Pistol": { pa:1, cat:"Pistol" },
    "Corp Pistol": { pa:1, cat:"Pistol" },
    "Teava SMG": { pa:2, cat:"SMG" },
    "Corp SMG": { pa:2, cat:"SMG" },
  },
  MASA: {
    "Tarnacop": { mat:["5x Cupru","5x Fier","5x Otel","2x Aur + 3x Otel","1x Diamant + 2x Aur"], cat:"Unelte" },
    "Topor": { mat:["5x Cupru","5x Fier","5x Otel","2x Aur + 3x Otel","1x Diamant + 2x Aur"], cat:"Unelte" },
    "Undita": { mat:["5x Plastic","3x Cupru","3x Aluminiu","3x Fier"], cat:"Unelte" },
  },
  LOC: {
    "Mina de Fier": { mat:["Fier","Carbune","Aur"], emoji:"‚õ∞Ô∏è", desc:"Job: Miner" },
    "Mina de Sulf": { mat:["Sulf","Plumb"], emoji:"üåã", desc:"Job: Miner" },
    "Mina de Cupru": { mat:["Cupru","Aluminiu","Carbune"], emoji:"üèîÔ∏è", desc:"Job: Miner" },
  }
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  INCARCARE DATE  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function loadCategories() {
  const saved = localStorage.getItem('craft_categories');
  return saved ? JSON.parse(saved) : [...DEFAULT_CATEGORIES];
}

function loadSubcategories() {
  const saved = localStorage.getItem('craft_subcategories');
  return saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(DEFAULT_SUBCATEGORIES));
}

function loadData() {
  const saved = localStorage.getItem('craft_app_data');
  if (saved) return JSON.parse(saved);
  return JSON.parse(JSON.stringify(DEFAULT_DATA));
}

function saveCategories() {
  localStorage.setItem('craft_categories', JSON.stringify(categories));
}

function saveSubcategories() {
  localStorage.setItem('craft_subcategories', JSON.stringify(subcategories));
}

function saveAppData() {
  localStorage.setItem('craft_app_data', JSON.stringify(APP_DATA));
}

let categories = loadCategories();
let subcategories = loadSubcategories();
let APP_DATA = loadData();
let currentDataCategory = 'arme';
let editingItem = null;
let modalMode = 'data'; // 'data', 'category', 'subcategory'

let MUNITIE = APP_DATA.MUNITIE;
let ARME = APP_DATA.ARME;
let COMP = APP_DATA.COMP;
let MATARME = APP_DATA.MATARME;
let MASA = APP_DATA.MASA;
let LOC = APP_DATA.LOC;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  SISTEM CALCULATOARE PERSONALIZATE  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function loadCalculators() {
  const saved = localStorage.getItem('craft_calculators');
  if (saved) {
    return JSON.parse(saved);
  }
  
  // Calculator COCAINƒÇ pre-configurat ca exemplu
  return [{
    id: 'calculator_cocaina',
    name: 'Procesare Cocaina',
    icon: 'üíé',
    tabId: 'cocaina',
    inputLabel: 'Numar Frunze de Coca',
    inputIcon: 'üåø',
    inputPlaceholder: '560',
    steps: [
      {
        name: 'Frunze de Coca',
        icon: 'üåø',
        color: 'gn',
        numberLabel: 'Frunze',
        weightLabel: 'kg'
      },
      {
        name: 'Sticle (Extractie)',
        icon: 'üß™',
        color: 'bl',
        numberLabel: 'Sticle',
        weightLabel: 'kg'
      },
      {
        name: 'Tavi (Uscare)',
        icon: 'üç≥',
        color: 'gl',
        numberLabel: 'Tavi',
        weightLabel: 'kg'
      },
      {
        name: 'Brichete (Presare)',
        icon: 'üß±',
        color: 'rd',
        numberLabel: 'Brichete',
        weightLabel: 'kg'
      },
      {
        name: 'Pungi (Impartire)',
        icon: 'üëú',
        color: 'vt',
        numberLabel: 'Pungi',
        weightLabel: 'kg'
      },
      {
        name: 'Plicuri (Final)',
        icon: 'üì¶',
        color: 'gn',
        numberLabel: 'Plicuri',
        weightLabel: 'kg'
      }
    ],
    summary: [
      {
        label: 'Total KG Procesate',
        icon: '‚öñÔ∏è',
        id: 'total_kg'
      },
      {
        label: 'Total Plicuri',
        icon: 'üì¶',
        id: 'total_plicuri'
      },
      {
        label: 'Profit Estimat',
        icon: 'üí∞',
        id: 'profit'
      }
    ],
    formula: `const f = inputs.cantitate;

// Calculez fiecare etapa: [numar_bucati, kg]
const fk = 0.04 * f;
const sn = 0.05 * f;
const sk = 0.4 * sn;
const tn = sn;
const tk = 0.3 * tn;
const bn = tn;
const bk = 0.2 * bn;
const pn = 2 * bn;
const pk = 0.03 * pn;
const ln = pn;
const lk = 0.2 * ln;

const steps = [
  [f, fk],
  [sn, sk],
  [tn, tk],
  [bn, bk],
  [pn, pk],
  [ln, lk]
];

const summary = {
  total_kg: (fk + sk + tk + bk + pk + lk).toFixed(2),
  total_plicuri: Math.floor(ln),
  profit: Math.floor(ln * 13600)
};

return { steps, summary };`
  }];
}

function saveCalculators() {
  localStorage.setItem('craft_calculators', JSON.stringify(calculators));
}

let calculators = loadCalculators();
let editingCalculator = null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  SISTEM MEMBRII - CORECTAT  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function loadMembers() {
  const saved = localStorage.getItem('craft_members');
  if (!saved) return {};
  try {
    return JSON.parse(saved);
  } catch(e) {
    console.error('Eroare la √ÆncƒÉrcarea membrilor:', e);
    return {};
  }
}

function saveMembers() {
  try {
    localStorage.setItem('craft_members', JSON.stringify(members));
    console.log('Membri salva»õi:', Object.keys(members).length);
  } catch(e) {
    console.error('Eroare la salvarea membrilor:', e);
  }
}

// Ini»õializare membri
let members = loadMembers();
let currentMemberFilter = 'all';
let memberSearchQuery = '';
let restrictingMemberId = null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  SISTEM AUTHENTIFICARE - OWNER + MEMBRI  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

let currentUser = null;
try {
  currentUser = JSON.parse(localStorage.getItem('craft_current_user') || 'null');
} catch(e) {
  currentUser = null;
}

let accessLog = [];
try {
  accessLog = JSON.parse(localStorage.getItem('craft_access_log') || '[]');
} catch(e) {
  accessLog = [];
}

function loginWithDiscord() {
  const params = new URLSearchParams({
    client_id: DISCORD_CONFIG.CLIENT_ID,
    redirect_uri: DISCORD_CONFIG.REDIRECT_URI,
    response_type: 'token',
    scope: DISCORD_CONFIG.SCOPE
  });
  window.location.href = `https://discord.com/api/oauth2/authorize?${params.toString()}`;
}

function loginOwner() {
  localStorage.setItem('craft_login_type', 'owner');
  loginWithDiscord();
}

function handleDiscordCallback() {
  const fragment = new URLSearchParams(window.location.hash.slice(1));
  const accessToken = fragment.get('access_token');
  
  if (fragment.get('error')) { 
    alert('Eroare Discord: ' + fragment.get('error')); 
    return; 
  }
  
  if (!accessToken) return;
  
  const loginType = localStorage.getItem('craft_login_type') || 'member';
  localStorage.removeItem('craft_login_type');
  
  fetch('https://discord.com/api/users/@me', {
    headers: { 'Authorization': `Bearer ${accessToken}` }
  })
  .then(r => { 
    if (!r.ok) throw new Error('HTTP ' + r.status); 
    return r.json(); 
  })
  .then(user => {
    const avatar = user.avatar
      ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
      : `https://cdn.discordapp.com/embed/avatars/${(parseInt(user.discriminator)||0) % 5}.png`;
    
    window.history.replaceState({}, document.title, window.location.pathname);
    
    // OWNER
    if (user.id === OWNER_ID) {
      currentUser = {
        id: user.id,
        username: user.username,
        avatar: avatar,
        approved: true,
        isOwner: true,
        isAdmin: true,
        loginTime: new Date().toISOString()
      };
      
      accessLog.push({ 
        time: new Date().toISOString(), 
        user: user.username, 
        id: user.id, 
        type: 'owner' 
      });
      
      localStorage.setItem('craft_access_log', JSON.stringify(accessLog));
      localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
      
      showMainApp();
      showNotification('üëë Bine ai venit, OWNER!');
      return;
    }
    
    // Tried owner login but not owner
    if (loginType === 'owner') {
      currentUser = {
        id: user.id,
        username: user.username,
        avatar: avatar,
        approved: false,
        isOwner: false
      };
      localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
      showOwnerDenied();
      return;
    }
    
    // Check blacklist
    if (members[user.id] && members[user.id].blacklisted) {
      currentUser = {
        id: user.id,
        username: user.username,
        avatar: avatar,
        approved: false,
        isOwner: false,
        blacklisted: true
      };
      localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
      showBlacklisted();
      return;
    }
    
    // Check restricted
    if (members[user.id] && members[user.id].restricted) {
      const restrictedUntil = members[user.id].restrictedUntil;
      const restrictedPermanent = members[user.id].restrictedPermanent;
      
      if (!restrictedPermanent && restrictedUntil && new Date(restrictedUntil) <= new Date()) {
        // Restric»õia a expirat, »ôterge restric»õia
        members[user.id].restricted = false;
        members[user.id].restrictedUntil = null;
        members[user.id].restrictedPermanent = false;
        saveMembers();
      } else {
        currentUser = {
          id: user.id,
          username: user.username,
          avatar: avatar,
          approved: false,
          isOwner: false,
          restricted: true,
          restrictedUntil: restrictedUntil,
          restrictedPermanent: restrictedPermanent
        };
        localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
        showRestricted();
        return;
      }
    }
    
    // Check approved + not expired
    if (members[user.id] && members[user.id].approved) {
      const expiresAt = members[user.id].expiresAt;
      if (expiresAt && new Date(expiresAt) > new Date()) {
        // Membru activ
        currentUser = {
          id: user.id,
          username: user.username,
          avatar: avatar,
          approved: true,
          isOwner: false,
          isAdmin: members[user.id].isAdmin || false,
          expiresAt: expiresAt,
          loginTime: new Date().toISOString()
        };
        
        // ActualizeazƒÉ datele membrului
        members[user.id].lastLogin = new Date().toISOString();
        members[user.id].loginCount = (members[user.id].loginCount || 0) + 1;
        members[user.id].username = user.username;
        members[user.id].avatar = avatar;
        saveMembers();
        
        accessLog.push({
          time: new Date().toISOString(),
          user: user.username,
          id: user.id,
          type: 'member'
        });
        localStorage.setItem('craft_access_log', JSON.stringify(accessLog));
        localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
        
        showMainApp();
        showNotification('‚úÖ Bine ai venit, ' + user.username + '!');
        return;
      } else {
        // Acces expirat
        members[user.id].approved = false;
        members[user.id].status = 'expired';
        saveMembers();
      }
    }
    
    // New or pending member - √éNREGISTREAZƒÇ MEMBRUL NOU
    if (!members[user.id]) {
      members[user.id] = {
        id: user.id,
        username: user.username,
        avatar: avatar,
        joinedAt: new Date().toISOString(),
        approved: false,
        isAdmin: false,
        blacklisted: false,
        restricted: false,
        status: 'pending',
        loginCount: 1,
        lastLogin: new Date().toISOString()
      };
    } else {
      // Membru existent, actualizeazƒÉ datele
      members[user.id].username = user.username;
      members[user.id].avatar = avatar;
      members[user.id].lastLogin = new Date().toISOString();
      members[user.id].loginCount = (members[user.id].loginCount || 0) + 1;
      
      if (!members[user.id].blacklisted && !members[user.id].restricted) {
        members[user.id].status = 'pending';
      }
    }
    
    saveMembers();
    
    currentUser = {
      id: user.id,
      username: user.username,
      avatar: avatar,
      approved: false,
      isOwner: false
    };
    localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
    
    showPendingApproval();
  })
  .catch(err => { 
    console.error('Eroare Discord:', err); 
    alert('Eroare Discord: ' + err.message); 
  });
}

function showOwnerDenied() {
  $('login-screen').style.display = 'flex';
  $('login-content').style.display = 'none';
  $('pending-content').style.display = 'block';
  $('main-app').classList.remove('unlocked');
  $('pending-avatar').src = currentUser.avatar;
  $('pending-name').textContent = currentUser.username;
  $('pending-id').textContent = 'ID: ' + currentUser.id;
  $('pending-box').className = 'pending-box denied';
  $('pending-title').textContent = '‚õî ACCES INTERZIS';
  $('pending-message').innerHTML = 'Nu esti OWNER-ul acestui calculator.<br>Butonul <b>Login OWNER</b> este doar pentru proprietar.<br><br>Foloseste <b>Conectare cu Discord</b> pentru a solicita acces.';
}

function showBlacklisted() {
  $('login-screen').style.display = 'flex';
  $('login-content').style.display = 'none';
  $('pending-content').style.display = 'block';
  $('main-app').classList.remove('unlocked');
  $('pending-avatar').src = currentUser.avatar;
  $('pending-name').textContent = currentUser.username;
  $('pending-id').textContent = 'ID: ' + currentUser.id;
  $('pending-box').className = 'pending-box blacklisted';
  $('pending-title').textContent = 'üö´ BLACKLISTED';
  $('pending-message').innerHTML = 'Contul tau a fost adaugat in <b style="color:#ff0000">BLACKLIST</b>.<br>Nu mai ai permisiunea de a folosi acest calculator.';
}

function showRestricted() {
  $('login-screen').style.display = 'flex';
  $('login-content').style.display = 'none';
  $('pending-content').style.display = 'block';
  $('main-app').classList.remove('unlocked');
  $('pending-avatar').src = currentUser.avatar;
  $('pending-name').textContent = currentUser.username;
  $('pending-id').textContent = 'ID: ' + currentUser.id;
  $('pending-box').className = 'pending-box denied';
  $('pending-title').textContent = '‚õî ACCES RESTRICTIONAT';
  
  if (currentUser.restrictedPermanent) {
    $('pending-message').innerHTML = 'Accesul tau a fost <b style="color:var(--r)">restrictionat permanent</b>.';
  } else if (currentUser.restrictedUntil) {
    const until = new Date(currentUser.restrictedUntil).toLocaleDateString('ro-RO',{day:'2-digit',month:'long',year:'numeric'});
    $('pending-message').innerHTML = 'Accesul tau a fost <b style="color:var(--r)">restrictionat</b>.<br>Restrictia expira pe: <b style="color:var(--s)">' + until + '</b>';
  } else {
    $('pending-message').innerHTML = 'Accesul tau a fost <b style="color:var(--r)">restrictionat</b>.';
  }
}

function showPendingApproval() {
  $('login-screen').style.display = 'flex';
  $('login-content').style.display = 'none';
  $('pending-content').style.display = 'block';
  $('main-app').classList.remove('unlocked');
  $('pending-avatar').src = currentUser.avatar;
  $('pending-name').textContent = currentUser.username;
  $('pending-id').textContent = 'ID: ' + currentUser.id;
  $('pending-box').className = 'pending-box';
  $('pending-title').textContent = '‚è≥ ASTEPTARE APROBARE';
  $('pending-message').innerHTML = 'Cererea ta a fost trimisa!<br>Asteapta aprobarea unui administrator.<br>Vei primi acces pentru <b style="color:var(--s)">' + ACCESS_DURATION_DAYS + ' zile</b>.';
}

function checkAccess() {
  if (!currentUser) { 
    showLoginScreen(); 
    return; 
  }
  
  if (currentUser.id === OWNER_ID && currentUser.isOwner) { 
    showMainApp(); 
    return; 
  }
  
  const md = members[currentUser.id];
  
  if (!md) { 
    showPendingApproval(); 
    return; 
  }
  
  if (md.blacklisted) { 
    currentUser.blacklisted = true; 
    localStorage.setItem('craft_current_user', JSON.stringify(currentUser)); 
    showBlacklisted(); 
    return; 
  }
  
  if (md.restricted) {
    const restrictedUntil = md.restrictedUntil;
    const restrictedPermanent = md.restrictedPermanent;
    
    if (!restrictedPermanent && restrictedUntil && new Date(restrictedUntil) <= new Date()) { 
      md.restricted = false; 
      saveMembers(); 
    } else { 
      currentUser.restricted = true; 
      currentUser.restrictedUntil = restrictedUntil; 
      currentUser.restrictedPermanent = restrictedPermanent; 
      localStorage.setItem('craft_current_user', JSON.stringify(currentUser)); 
      showRestricted(); 
      return; 
    }
  }
  
  if (md.approved && md.expiresAt && new Date(md.expiresAt) > new Date()) {
    currentUser.approved = true; 
    currentUser.isAdmin = md.isAdmin || false; 
    currentUser.expiresAt = md.expiresAt;
    localStorage.setItem('craft_current_user', JSON.stringify(currentUser));
    showMainApp(); 
    return;
  }
  
  if (md.approved) { 
    md.approved = false; 
    md.status = 'expired'; 
    saveMembers(); 
  }
  
  showPendingApproval();
}

function showLoginScreen() {
  $('login-screen').style.display = 'flex';
  $('login-content').style.display = 'block';
  $('pending-content').style.display = 'none';
  $('main-app').classList.remove('unlocked');
  $('admin-toggle').style.display = 'none';
  $('admin-panel').style.display = 'none';
}

function showMainApp() {
  $('login-screen').style.display = 'none';
  $('main-app').classList.add('unlocked');
  $('user-avatar').src = currentUser.avatar;
  $('user-display-name').textContent = currentUser.username;
  
  if (currentUser.isOwner) {
    $('user-role-badge').innerHTML = '<span class="owner-badge">üëë OWNER</span>';
    $('user-display-name').style.color = 'var(--owner)';
    $('user-avatar').style.borderColor = 'var(--owner)';
    $('admin-toggle').style.display = 'block';
    $('admin-name').textContent = currentUser.username;
    $('user-expiry-info').textContent = '';
  } else if (currentUser.isAdmin) {
    $('user-role-badge').innerHTML = '<span class="admin-badge-tag">‚≠ê ADMIN</span>';
    $('user-display-name').style.color = 'var(--s)';
    $('user-avatar').style.borderColor = 'var(--s)';
    $('admin-toggle').style.display = 'none';
    if (currentUser.expiresAt) { 
      const d = Math.ceil((new Date(currentUser.expiresAt) - new Date()) / (1e3 * 60 * 60 * 24)); 
      $('user-expiry-info').textContent = '‚è∞ ' + d + ' zile'; 
    }
  } else {
    $('user-role-badge').innerHTML = '<span class="member-badge">üë§ MEMBRU</span>';
    $('user-display-name').style.color = '#5865F2';
    $('user-avatar').style.borderColor = '#5865F2';
    $('admin-toggle').style.display = 'none';
    if (currentUser.expiresAt) {
      const d = Math.ceil((new Date(currentUser.expiresAt) - new Date()) / (1e3 * 60 * 60 * 24));
      $('user-expiry-info').textContent = '‚è∞ ' + d + ' zile';
      $('user-expiry-info').style.color = d <= 3 ? 'var(--r)' : d <= 7 ? '#ffc107' : 'var(--dm)';
    }
  }
  
  renderMainCategories(); 
  renderDynamicPanels();
}

function logout() { 
  currentUser = null; 
  localStorage.removeItem('craft_current_user'); 
  showLoginScreen(); 
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  ADMIN PANEL  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function toggleAdmin() {
  const p = $('admin-panel');
  if (p.style.display === 'none' || !p.style.display) {
    p.style.display = 'block';
    renderMemberList(); 
    renderCategoriesList(); 
    renderSubcategoriesList(); 
    renderDataTabs(); 
    renderDataList(); 
    updateStats();
  } else {
    p.style.display = 'none';
  }
}

// ‚úÖ CORECTAT: AdƒÉugat parametrul clickedBtn
function switchAdminTab(tab, clickedBtn) {
  document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
  clickedBtn.classList.add('active');
  $('admin-' + tab).classList.add('active');
  
  if (tab === 'members') renderMemberList();
  if (tab === 'categories') renderCategoriesList();
  if (tab === 'subcategories') renderSubcategoriesList();
  if (tab === 'data') {
    renderDataTabs();
    renderDataList();
  }
  if (tab === 'calculators') renderCalculatorsList();
}

function updateStats() {
  const arr = Object.values(members);
  const now = new Date();
  
  $('stat-total').textContent = arr.length;
  $('stat-active').textContent = arr.filter(m => 
    m.approved && m.expiresAt && new Date(m.expiresAt) > now && !m.blacklisted && !m.restricted
  ).length;
  $('stat-pending').textContent = arr.filter(m => 
    !m.approved && !m.blacklisted && !m.restricted && m.status !== 'expired'
  ).length;
  $('stat-blacklisted').textContent = arr.filter(m => m.blacklisted).length;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  MEMBER MANAGEMENT - CORECTAT  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function getMemberStatus(m) {
  if (m.blacklisted) return 'blacklisted';
  if (m.restricted) return 'restricted';
  if (m.approved && m.expiresAt && new Date(m.expiresAt) > new Date()) return 'active';
  if (m.approved || m.status === 'expired') return 'expired';
  return 'pending';
}

function filterMembers(q) {
  memberSearchQuery = q.toLowerCase();
  renderMemberList();
}

function setMemberFilter(f, btn) {
  currentMemberFilter = f;
  document.querySelectorAll('.admin-filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderMemberList();
}

function renderMemberList() {
  const c = $('member-list'); 
  c.innerHTML = '';
  
  let arr = Object.values(members);
  
  if (memberSearchQuery) {
    arr = arr.filter(m => 
      m.username.toLowerCase().includes(memberSearchQuery) || 
      m.id.includes(memberSearchQuery)
    );
  }
  
  if (currentMemberFilter !== 'all') {
    arr = arr.filter(m => getMemberStatus(m) === currentMemberFilter);
  }
  
  const ord = { pending: 0, active: 1, expired: 2, restricted: 3, blacklisted: 4 };
  arr.sort((a, b) => (ord[getMemberStatus(a)] || 5) - (ord[getMemberStatus(b)] || 5));
  
  if (!arr.length) {
    c.innerHTML = '<div style="text-align:center;padding:25px;color:var(--dm);font-size:.85rem;">Niciun membru gasit</div>';
    return;
  }
  
  arr.forEach(m => {
    const st = getMemberStatus(m);
    const item = document.createElement('div');
    let cls = 'member-item';
    
    if (st === 'pending') cls += ' pending-item';
    if (st === 'blacklisted') cls += ' blacklisted-item';
    if (st === 'restricted') cls += ' restricted-item';
    if (m.isAdmin && st === 'active') cls += ' admin-item';
    if (st === 'expired') cls += ' expired-item';
    
    item.className = cls;
    
    let badge = '';
    switch(st) {
      case 'active': 
        badge = m.isAdmin ? '<span class="member-status admin-status">‚≠ê Admin</span>' : '<span class="member-status active">‚úÖ Activ</span>'; 
        break;
      case 'pending': 
        badge = '<span class="member-status pending">‚è≥ Asteptare</span>'; 
        break;
      case 'expired': 
        badge = '<span class="member-status expired">‚è∞ Expirat</span>'; 
        break;
      case 'blacklisted': 
        badge = '<span class="member-status blacklisted">üö´ Blacklist</span>'; 
        break;
      case 'restricted': 
        badge = '<span class="member-status restricted">‚õî Restrict</span>'; 
        break;
    }
    
    let exp = '';
    if (m.expiresAt && st === 'active') {
      const d = Math.ceil((new Date(m.expiresAt) - new Date()) / (1e3 * 60 * 60 * 24));
      exp = `<div class="member-expiry ${d <= 3 ? 'expired' : d <= 7 ? 'expiring-soon' : ''}">‚Ä¢ ${d} zile (exp: ${new Date(m.expiresAt).toLocaleDateString('ro-RO')})</div>`;
    }
    if (st === 'restricted' && m.restrictedPermanent) {
      exp = '<div class="member-expiry expired">‚Ä¢ Permanent</div>';
    } else if (st === 'restricted' && m.restrictedUntil) {
      exp = `<div class="member-expiry expired">‚Ä¢ Pana: ${new Date(m.restrictedUntil).toLocaleDateString('ro-RO')}</div>`;
    }
    
    let acts = '';
    if (st === 'pending') {
      acts = `<button class="m-action-btn approve" onclick="approveMember('${m.id}')">‚úÖ Aproba</button><button class="m-action-btn blacklist" onclick="blacklistMember('${m.id}')">üö´</button><button class="m-action-btn delete" onclick="deleteMember('${m.id}')">üóëÔ∏è</button>`;
    } else if (st === 'active') {
      acts = `<button class="m-action-btn make-admin" onclick="toggleAdminMember('${m.id}')">${m.isAdmin ? 'üë§' : '‚≠ê'}</button><button class="m-action-btn restrict" onclick="openRestrictModal('${m.id}')">‚õî</button><button class="m-action-btn blacklist" onclick="blacklistMember('${m.id}')">üö´</button><button class="m-action-btn delete" onclick="deleteMember('${m.id}')">üóëÔ∏è</button>`;
    } else if (st === 'expired') {
      acts = `<button class="m-action-btn reactivate" onclick="approveMember('${m.id}')">üîÑ</button><button class="m-action-btn blacklist" onclick="blacklistMember('${m.id}')">üö´</button><button class="m-action-btn delete" onclick="deleteMember('${m.id}')">üóëÔ∏è</button>`;
    } else if (st === 'restricted') {
      acts = `<button class="m-action-btn reactivate" onclick="unrestrictMember('${m.id}')">üîì</button><button class="m-action-btn blacklist" onclick="blacklistMember('${m.id}')">üö´</button><button class="m-action-btn delete" onclick="deleteMember('${m.id}')">üóëÔ∏è</button>`;
    } else if (st === 'blacklisted') {
      acts = `<button class="m-action-btn reactivate" onclick="unblacklistMember('${m.id}')">üîì</button><button class="m-action-btn delete" onclick="deleteMember('${m.id}')">üóëÔ∏è</button>`;
    }
    
    const fallbackAvatar = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%235865F2' width='100' height='100'/><text y='.9em' x='50' text-anchor='middle' font-size='60'>üë§</text></svg>";
    
    item.innerHTML = `
      <img src="${m.avatar || fallbackAvatar}" class="member-avatar ${m.isAdmin ? 'admin' : ''}" onerror="this.src='${fallbackAvatar}'">
      <div class="member-info">
        <div class="member-name">${m.username} ${badge}</div>
        <div class="member-meta">ID: ${m.id} ‚Ä¢ x${m.loginCount || 0} ‚Ä¢ ${new Date(m.joinedAt || Date.now()).toLocaleDateString('ro-RO')}</div>
        ${exp}
      </div>
      <div class="member-actions">${acts}</div>
    `;
    c.appendChild(item);
  });
  
  updateStats();
}

function approveMember(id) {
  if (!members[id]) return;
  
  members[id].approved = true;
  members[id].status = 'active';
  members[id].expiresAt = new Date(Date.now() + ACCESS_DURATION_MS).toISOString();
  members[id].approvedAt = new Date().toISOString();
  
  saveMembers();
  renderMemberList();
  showNotification('‚úÖ ' + members[id].username + ' - acces ' + ACCESS_DURATION_DAYS + ' zile!');
}

function toggleAdminMember(id) {
  if (!members[id]) return;
  
  members[id].isAdmin = !members[id].isAdmin;
  saveMembers();
  renderMemberList();
  showNotification((members[id].isAdmin ? '‚≠ê' : 'üë§') + ' ' + members[id].username + (members[id].isAdmin ? ' este Admin' : ' nu mai e Admin'));
}

function openRestrictModal(id) {
  restrictingMemberId = id;
  const m = members[id];
  if (!m) return;
  
  $('restrict-content').innerHTML = `
    <div style="padding:12px;background:rgba(0,0,0,.2);border-radius:10px;margin-bottom:15px;display:flex;align-items:center;gap:10px;">
      <img src="${m.avatar}" style="width:36px;height:36px;border-radius:50%;">
      <div><b>${m.username}</b><br><span style="font-size:.7rem;color:var(--dm)">ID: ${m.id}</span></div>
    </div>
    <div class="form-group">
      <label>Tip</label>
      <select id="restrict-type" onchange="$('restrict-dur').style.display=this.value==='permanent'?'none':'block'">
        <option value="temporary">Temporara</option>
        <option value="permanent">Permanenta</option>
      </select>
    </div>
    <div class="form-group" id="restrict-dur">
      <label>Zile</label>
      <input type="number" id="restrict-days" value="7" min="1" max="365">
    </div>
    <div class="form-group">
      <label>Motiv</label>
      <textarea id="restrict-reason" placeholder="Optional..."></textarea>
    </div>
  `;
  
  $('restrict-modal').classList.add('active');
}

function confirmRestrict() {
  if (!restrictingMemberId || !members[restrictingMemberId]) return;
  
  const type = $('restrict-type').value;
  const days = parseInt($('restrict-days')?.value) || 7;
  const m = members[restrictingMemberId];
  
  m.restricted = true;
  m.approved = false;
  m.status = 'restricted';
  m.restrictedPermanent = type === 'permanent';
  m.restrictedUntil = type === 'permanent' ? null : new Date(Date.now() + days * 864e5).toISOString();
  m.restrictReason = $('restrict-reason')?.value || '';
  m.isAdmin = false;
  
  saveMembers();
  closeRestrictModal();
  renderMemberList();
  showNotification('‚õî ' + m.username + ' restrictionat' + (type === 'permanent' ? ' permanent' : ' ' + days + ' zile'));
}

function closeRestrictModal() {
  $('restrict-modal').classList.remove('active');
  restrictingMemberId = null;
}

function unrestrictMember(id) {
  if (!members[id]) return;
  
  members[id].restricted = false;
  members[id].restrictedUntil = null;
  members[id].restrictedPermanent = false;
  members[id].status = 'pending';
  
  saveMembers();
  renderMemberList();
  showNotification('üîì ' + members[id].username + ' deblocat!');
}

function blacklistMember(id) {
  if (!members[id]) return;
  if (!confirm('Blacklist "' + members[id].username + '"?')) return;
  
  members[id].blacklisted = true;
  members[id].approved = false;
  members[id].restricted = false;
  members[id].isAdmin = false;
  members[id].status = 'blacklisted';
  
  saveMembers();
  renderMemberList();
  showNotification('üö´ ' + members[id].username + ' BLACKLISTED!');
}

function unblacklistMember(id) {
  if (!members[id]) return;
  
  members[id].blacklisted = false;
  members[id].status = 'pending';
  
  saveMembers();
  renderMemberList();
  showNotification('üîì ' + members[id].username + ' scos din blacklist!');
}

function deleteMember(id) {
  if (!members[id]) return;
  if (!confirm('STERGE DEFINITIV "' + members[id].username + '"?')) return;
  
  const n = members[id].username;
  delete members[id];
  saveMembers();
  renderMemberList();
  showNotification('üóëÔ∏è ' + n + ' sters!');
}

function clearExpiredMembers() {
  const exp = Object.values(members).filter(m => getMemberStatus(m) === 'expired');
  if (!exp.length) {
    alert('Niciun membru expirat!');
    return;
  }
  if (!confirm('Sterge ' + exp.length + ' membri expirat?')) return;
  
  exp.forEach(m => delete members[m.id]);
  saveMembers();
  renderMemberList();
  showNotification('üóëÔ∏è ' + exp.length + ' stersi!');
}

function exportMembers() {
  const d = { members, exportDate: new Date().toISOString() };
  const b = new Blob([JSON.stringify(d, null, 2)], { type: 'application/json' });
  const l = document.createElement('a');
  l.href = URL.createObjectURL(b);
  l.download = 'craft_members_' + new Date().toISOString().split('T')[0] + '.json';
  l.click();
  showNotification('üë• Membri exportati!');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  MANAGER CATEGORII  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function renderCategoriesList() {
  const container = $('category-list');
  container.innerHTML = '';
  
  categories.forEach((cat, index) => {
    const item = document.createElement('div');
    item.className = 'category-item ' + (index === 0 ? 'active' : '');
    item.innerHTML = `
      <div class="category-info">
        <span class="category-icon">${cat.icon}</span>
        <div>
          <div class="category-name">${cat.name}</div>
          <div class="category-id">ID: ${cat.id}</div>
        </div>
      </div>
      <div class="data-item-actions">
        <button class="icon-btn edit" onclick="editCategory(${index})">‚úèÔ∏è</button>
        <button class="icon-btn delete" onclick="deleteCategory(${index})">üóëÔ∏è</button>
      </div>
    `;
    container.appendChild(item);
  });
}

function openCategoryModal(editIndex = null) {
  modalMode = 'category';
  editingItem = editIndex;
  
  const cat = editIndex !== null ? categories[editIndex] : null;
  
  $('modal-title').textContent = editIndex !== null ? 'Editeaza Categorie' : 'Adauga Categorie Noua';
  $('modal-content').innerHTML = `
    <div class="form-group">
      <label>ID Categorie (unic, fara spatii)</label>
      <input type="text" id="cat-id" value="${cat?.id || ''}" ${cat ? 'readonly' : ''} placeholder="ex: mafie, legal, arme">
    </div>
    <div class="form-group">
      <label>Nume Afisat</label>
      <input type="text" id="cat-name" value="${cat?.name || ''}" placeholder="ex: CRAFT ARME">
    </div>
    <div class="form-group">
      <label>Icon (emoji)</label>
      <input type="text" id="cat-icon" value="${cat?.icon || 'üî´'}" maxlength="2">
    </div>
    <div class="form-group">
      <label>Subtitlu</label>
      <input type="text" id="cat-sub" value="${cat?.sub || ''}" placeholder="ex: Cocaina ‚Ä¢ Gloante ‚Ä¢ Arme">
    </div>
    <div class="form-group">
      <label>Culoare Tema</label>
      <select id="cat-color">
        <option value="mafie" ${cat?.color === 'mafie' ? 'selected' : ''}>Mafie (Rosu)</option>
        <option value="legal" ${cat?.color === 'legal' ? 'selected' : ''}>Legal (Verde)</option>
      </select>
    </div>
  `;
  
  $('modal-overlay').classList.add('active');
}

function editCategory(index) {
  openCategoryModal(index);
}

function deleteCategory(index) {
  if (categories.length <= 1) {
    alert('Trebuie sa existe cel putin o categorie!');
    return;
  }
  
  if (confirm('Sigur vrei sa stergi aceasta categorie? Toate subcategoriile si datele asociate vor fi pierdute!')) {
    const catId = categories[index].id;
    categories.splice(index, 1);
    saveCategories();
    
    delete subcategories[catId];
    saveSubcategories();
    
    delete APP_DATA[catId.toUpperCase()];
    saveAppData();
    
    renderCategoriesList();
    renderSubcategoriesList();
    renderMainCategories();
    renderDynamicPanels();
    renderDataTabs();
  }
}

function saveCategory() {
  const id = $('cat-id').value.trim().toLowerCase();
  const name = $('cat-name').value.trim();
  const icon = $('cat-icon').value;
  const sub = $('cat-sub').value.trim();
  const color = $('cat-color').value;
  
  if (!id || !name) {
    alert('ID si Numele sunt obligatorii!');
    return;
  }
  
  if (!/^[a-z0-9_]+$/.test(id)) {
    alert('ID-ul poate contine doar litere mici, cifre si underscore!');
    return;
  }
  
  const newCat = { id, name, icon, sub, color };
  
  if (editingItem !== null) {
    const oldId = categories[editingItem].id;
    categories[editingItem] = newCat;
    
    if (oldId !== id) {
      if (subcategories[oldId]) {
        subcategories[id] = subcategories[oldId];
        delete subcategories[oldId];
        saveSubcategories();
      }
      if (APP_DATA[oldId.toUpperCase()]) {
        APP_DATA[id.toUpperCase()] = APP_DATA[oldId.toUpperCase()];
        delete APP_DATA[oldId.toUpperCase()];
        saveAppData();
      }
    }
  } else {
    if (categories.find(c => c.id === id)) {
      alert('Exista deja o categorie cu acest ID!');
      return;
    }
    categories.push(newCat);
    subcategories[id] = [];
    saveSubcategories();
    
    APP_DATA[id.toUpperCase()] = {};
    saveAppData();
  }
  
  saveCategories();
  closeModal();
  renderCategoriesList();
  renderSubcategoriesList();
  renderMainCategories();
  renderDynamicPanels();
  renderDataTabs();
  showNotification(`Categoria "${name}" a fost ${editingItem !== null ? 'actualizata' : 'adaugata'}!`);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  MANAGER SUBCATEGORII  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function renderSubcategoriesList() {
  const container = $('subcategory-list');
  container.innerHTML = '';
  
  categories.forEach(cat => {
    const catHeader = document.createElement('div');
    catHeader.style.cssText = 'padding: 10px; background: rgba(255,0,0,.1); border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--owner);';
    catHeader.innerHTML = `<b style="color: var(--owner);">${cat.icon} ${cat.name}</b>`;
    container.appendChild(catHeader);
    
    const subs = subcategories[cat.id] || [];
    if (subs.length === 0) {
      const empty = document.createElement('div');
      empty.style.cssText = 'padding: 8px; color: var(--dm); font-size: 0.8rem; font-style: italic;';
      empty.textContent = 'Nu exista subcategorii';
      container.appendChild(empty);
    } else {
      subs.forEach((sub, index) => {
        const item = document.createElement('div');
        item.className = 'category-item';
        item.style.marginLeft = '20px';
        item.innerHTML = `
          <div class="category-info">
            <span class="category-icon">${sub.icon}</span>
            <div>
              <div class="category-name">${sub.name}</div>
              <div class="category-id">ID: ${sub.id} | Tip: ${sub.type}</div>
            </div>
          </div>
          <div class="data-item-actions">
            <button class="icon-btn edit" onclick="editSubcategory('${cat.id}', ${index})">‚úèÔ∏è</button>
            <button class="icon-btn delete" onclick="deleteSubcategory('${cat.id}', ${index})">üóëÔ∏è</button>
          </div>
        `;
        container.appendChild(item);
      });
    }
  });
}

function openSubcategoryModal(editCatId = null, editIndex = null) {
  modalMode = 'subcategory';
  editingItem = { catId: editCatId, index: editIndex };
  
  const sub = editIndex !== null ? subcategories[editCatId][editIndex] : null;
  
  $('modal-title').textContent = editIndex !== null ? 'Editeaza Subcategorie' : 'Adauga Subcategorie Noua';
  $('modal-content').innerHTML = `
    <div class="form-group">
      <label>Categorie Parinte</label>
      <select id="sub-cat-parent" ${editIndex !== null ? 'disabled' : ''}>
        ${categories.map(c => `<option value="${c.id}" ${c.id === editCatId ? 'selected' : ''}>${c.name}</option>`).join('')}
      </select>
    </div>
    <div class="form-group">
      <label>ID Subcategorie (unic, fara spatii)</label>
      <input type="text" id="sub-id" value="${sub?.id || ''}" ${sub ? 'readonly' : ''} placeholder="ex: gloante, arme, masa">
    </div>
    <div class="form-group">
      <label>Nume Afisat</label>
      <input type="text" id="sub-name" value="${sub?.name || ''}" placeholder="ex: Gloante">
    </div>
    <div class="form-group">
      <label>Icon (emoji)</label>
      <input type="text" id="sub-icon" value="${sub?.icon || 'üéØ'}" maxlength="2">
    </div>
    <div class="form-group">
      <label>Tip Afisare</label>
      <select id="sub-type">
        <option value="calculator" ${sub?.type === 'calculator' ? 'selected' : ''}>Calculator (input numeric)</option>
        <option value="table" ${sub?.type === 'table' ? 'selected' : ''}>Tabel (lista date)</option>
        <option value="cards" ${sub?.type === 'cards' ? 'selected' : ''}>Carduri (grid)</option>
      </select>
    </div>
  `;
  
  $('modal-overlay').classList.add('active');
}

function editSubcategory(catId, index) {
  openSubcategoryModal(catId, index);
}

function deleteSubcategory(catId, index) {
  if (confirm('Sigur vrei sa stergi aceasta subcategorie?')) {
    subcategories[catId].splice(index, 1);
    saveSubcategories();
    renderSubcategoriesList();
    renderDynamicPanels();
  }
}

function saveSubcategory() {
  const parentCat = $('sub-cat-parent').value;
  const id = $('sub-id').value.trim().toLowerCase();
  const name = $('sub-name').value.trim();
  const icon = $('sub-icon').value;
  const type = $('sub-type').value;
  
  if (!id || !name) {
    alert('ID si Numele sunt obligatorii!');
    return;
  }
  
  if (!/^[a-z0-9_]+$/.test(id)) {
    alert('ID-ul poate contine doar litere mici, cifre si underscore!');
    return;
  }
  
  const newSub = { id, name, icon, type };
  
  if (editingItem.index !== null) {
    subcategories[editingItem.catId][editingItem.index] = newSub;
  } else {
    if (!subcategories[parentCat]) subcategories[parentCat] = [];
    if (subcategories[parentCat].find(s => s.id === id)) {
      alert('Exista deja o subcategorie cu acest ID in aceasta categorie!');
      return;
    }
    subcategories[parentCat].push(newSub);
  }
  
  saveSubcategories();
  closeModal();
  renderSubcategoriesList();
  renderDynamicPanels();
  showNotification(`Subcategoria "${name}" a fost ${editingItem.index !== null ? 'actualizata' : 'adaugata'}!`);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  MANAGER CALCULATOARE PERSONALIZATE  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function renderCalculatorsList() {
  const container = $('calculator-list');
  container.innerHTML = '';
  
  if (calculators.length === 0) {
    container.innerHTML = '<div style="padding:20px;text-align:center;color:var(--dm);font-style:italic;">Nu exista calculatoare personalizate</div>';
    return;
  }
  
  calculators.forEach((calc, index) => {
    const item = document.createElement('div');
    item.className = 'calculator-item';
    
    const stepsHtml = calc.steps.map(step => {
      const label = step.numberLabel ? `${step.numberLabel}` : 'Buc';
      return `<div class="calculator-input-badge" style="background:rgba(0,255,136,.1);border-color:rgba(0,255,136,.3);">${step.icon} ${step.name} <span style="color:var(--dm);font-size:0.65rem;">(${label} | ${step.weightLabel || 'kg'})</span></div>`;
    }).join('');
    
    const summaryHtml = calc.summary.map(sum => 
      `<div class="calculator-output-badge">${sum.icon} ${sum.label}</div>`
    ).join('');
    
    item.innerHTML = `
      <div class="calculator-header">
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="calculator-icon">${calc.icon}</span>
          <div>
            <div class="calculator-name">${calc.name}</div>
            <div class="calculator-meta">ID: ${calc.id} | Tab: ${calc.tabId}</div>
            <div class="calculator-meta">Input: ${calc.inputIcon} ${calc.inputLabel}</div>
          </div>
        </div>
        <div class="data-item-actions">
          <button class="icon-btn edit" onclick="editCalculator(${index})">‚úèÔ∏è</button>
          <button class="icon-btn delete" onclick="deleteCalculator(${index})">üóëÔ∏è</button>
        </div>
      </div>
      <div style="margin-bottom:8px;">
        <div style="font-size:0.75rem;color:var(--dm);margin-bottom:4px;">üìä ETAPE PROCESARE (${calc.steps.length} etape):</div>
        <div class="calculator-inputs">${stepsHtml}</div>
      </div>
      <div>
        <div style="font-size:0.75rem;color:var(--dm);margin-bottom:4px;">üìà SUMAR FINAL (${calc.summary.length} rezultate):</div>
        <div class="calculator-outputs">${summaryHtml}</div>
      </div>
    `;
    
    container.appendChild(item);
  });
}

function openCalculatorModal(editIndex = null) {
  editingCalculator = editIndex;
  const calc = editIndex !== null ? calculators[editIndex] : null;
  
  $('modal-title').textContent = editIndex !== null ? 'Editeaza Calculator' : 'Adauga Calculator Nou';
  
  const stepsHtml = (calc?.steps || []).map((step, idx) => `
    <div class="field-row" style="flex-wrap:wrap;gap:8px;margin-bottom:12px;padding:12px;background:rgba(0,0,0,.15);border-radius:8px;">
      <div style="width:100%;display:flex;gap:8px;align-items:center;">
        <input type="text" placeholder="Nume Etapa (ex: Frunze Cannabis)" value="${step.name}" data-step-idx="${idx}" data-field="name" style="flex:2;">
        <input type="text" placeholder="Icon" value="${step.icon}" maxlength="2" style="width:60px;" data-step-idx="${idx}" data-field="icon">
        <select data-step-idx="${idx}" data-field="color" style="width:120px;">
          <option value="gn" ${step.color === 'gn' ? 'selected' : ''}>üü¢ Verde</option>
          <option value="bl" ${step.color === 'bl' ? 'selected' : ''}>üîµ Albastru</option>
          <option value="gl" ${step.color === 'gl' ? 'selected' : ''}>üü° Galben</option>
          <option value="rd" ${step.color === 'rd' ? 'selected' : ''}>üî¥ Rosu</option>
          <option value="vt" ${step.color === 'vt' ? 'selected' : ''}>üü£ Violet</option>
          <option value="cu" ${step.color === 'cu' ? 'selected' : ''}>üü§ Cupru</option>
        </select>
        <button onclick="removeCalcStep(${idx})" style="padding:8px 12px;">‚úï</button>
      </div>
      <div style="width:100%;display:flex;gap:8px;">
        <input type="text" placeholder="Label Numar (ex: Joint-uri, Plicuri, Buc)" value="${step.numberLabel || ''}" data-step-idx="${idx}" data-field="numberLabel" style="flex:1;">
        <input type="text" placeholder="Label Greutate (ex: kg, grame, L)" value="${step.weightLabel || 'kg'}" data-step-idx="${idx}" data-field="weightLabel" style="flex:1;">
      </div>
      <div style="width:100%;font-size:0.7rem;color:var(--dm);">
        üí° Exemplu afi»ôare: <b>${step.numberLabel || '160'}</b> ${step.name || 'Plicuri'} | <b>25.00</b> ${step.weightLabel || 'kg'}
      </div>
    </div>
  `).join('');
  
  const summaryHtml = (calc?.summary || []).map((sum, idx) => `
    <div class="field-row">
      <input type="text" placeholder="Label (ex: Total KG)" value="${sum.label}" data-summary-idx="${idx}" data-field="label">
      <input type="text" placeholder="Icon" value="${sum.icon}" maxlength="2" style="width:60px;" data-summary-idx="${idx}" data-field="icon">
      <input type="text" placeholder="ID (ex: total_kg)" value="${sum.id}" data-summary-idx="${idx}" data-field="id">
      <button onclick="removeCalcSummary(${idx})">‚úï</button>
    </div>
  `).join('');
  
  $('modal-content').innerHTML = `
    <div class="form-group">
      <label>ID Calculator (unic, fara spatii)</label>
      <input type="text" id="calc-id" value="${calc?.id || ''}" ${calc ? 'readonly' : ''} placeholder="ex: calculator_tigari">
    </div>
    <div class="form-group">
      <label>Nume Calculator</label>
      <input type="text" id="calc-name" value="${calc?.name || ''}" placeholder="ex: Calculator Tigari">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Icon (emoji)</label>
        <input type="text" id="calc-icon" value="${calc?.icon || 'üßÆ'}" maxlength="2">
      </div>
      <div class="form-group">
        <label>Tab ID (unde se afiseaza)</label>
        <input type="text" id="calc-tab" value="${calc?.tabId || ''}" placeholder="ex: drugs, food">
      </div>
    </div>
    
    <div class="form-group">
      <label>Label Input Principal</label>
      <input type="text" id="calc-input-label" value="${calc?.inputLabel || 'Cantitate'}" placeholder="ex: Numar Frunze, Cantitate">
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Icon Input</label>
        <input type="text" id="calc-input-icon" value="${calc?.inputIcon || 'üì¶'}" maxlength="2">
      </div>
      <div class="form-group">
        <label>Placeholder Input</label>
        <input type="text" id="calc-input-placeholder" value="${calc?.inputPlaceholder || '100'}" placeholder="ex: 560, 100">
      </div>
    </div>
    
    <div class="dynamic-fields">
      <h4>üìä ETAPE PROCESARE (carduri colorate ca la cocaina) <button class="add-field-btn" onclick="addCalcStep()">+ Adauga Etapa</button></h4>
      <div id="calc-steps-container">${stepsHtml || '<div style="color:var(--dm);font-size:0.8rem;padding:10px;">Apasa pentru a adauga etape de procesare</div>'}</div>
      <div style="font-size:0.7rem;color:var(--dm);margin-top:8px;">
        üí° Fiecare etapa = un card colorat (ex: Frunze, Sticle, Tavi, etc.)
      </div>
    </div>
    
    <div class="dynamic-fields">
      <h4>üìà SUMAR FINAL (rezultate afisate jos) <button class="add-field-btn" onclick="addCalcSummary()">+ Adauga Rezultat</button></h4>
      <div id="calc-summary-container">${summaryHtml || '<div style="color:var(--dm);font-size:0.8rem;padding:10px;">Apasa pentru a adauga rezultate in sumar</div>'}</div>
      <div style="font-size:0.7rem;color:var(--dm);margin-top:8px;">
        üí° Exemple: Total KG, Total Plicuri, Profit Estimat
      </div>
    </div>
    
    <div class="form-group">
      <label>Formula Calcul (JavaScript) - Returneaza array de etape si obiect summary</label>
      <textarea id="calc-formula" placeholder="Exemplu cocaina:
const input = inputs.cantitate;
const steps = [
  [input, input * 0.04],           // Frunze (nr, kg)
  [input * 0.05, input * 0.02],    // Sticle
  [input * 0.05, input * 0.015],   // Tavi
  [input * 0.05, input * 0.01],    // Brichete
  [input * 0.1, input * 0.003],    // Pungi
  [input * 0.1, input * 0.02]      // Plicuri
];
const summary = {
  total_kg: (steps.map(s => s[1]).reduce((a,b) => a+b, 0)).toFixed(2),
  total_plicuri: Math.floor(steps[5][0]),
  profit: Math.floor(steps[5][0] * 13600)
};
return { steps, summary };" style="font-family:'JetBrains Mono',monospace;font-size:0.85rem;min-height:200px;">${calc?.formula || ''}</textarea>
      <div style="font-size:0.7rem;color:var(--dm);margin-top:6px;">
        üí° inputs.cantitate = valoarea din input | Returneaza { steps: [[nr, kg], ...], summary: {id: value} }
      </div>
    </div>
  `;
  
  $('modal-overlay').classList.add('active');
}

function addCalcStep() {
  const container = $('calc-steps-container');
  if (container.querySelector('div[style*="Apasa pentru"]')) {
    container.innerHTML = '';
  }
  
  const newIdx = container.querySelectorAll('[data-step-idx="0"]').length;
  const row = document.createElement('div');
  row.style.cssText = 'flex-wrap:wrap;gap:8px;margin-bottom:12px;padding:12px;background:rgba(0,0,0,.15);border-radius:8px;';
  row.innerHTML = `
    <div style="width:100%;display:flex;gap:8px;align-items:center;">
      <input type="text" placeholder="Nume Etapa (ex: Frunze Cannabis)" data-step-idx="${newIdx}" data-field="name" style="flex:2;">
      <input type="text" placeholder="Icon" value="üì¶" maxlength="2" style="width:60px;" data-step-idx="${newIdx}" data-field="icon">
      <select data-step-idx="${newIdx}" data-field="color" style="width:120px;">
        <option value="gn">üü¢ Verde</option>
        <option value="bl">üîµ Albastru</option>
        <option value="gl">üü° Galben</option>
        <option value="rd">üî¥ Rosu</option>
        <option value="vt">üü£ Violet</option>
        <option value="cu">üü§ Cupru</option>
      </select>
      <button onclick="this.closest('div[style*=flex-wrap]').remove()" style="padding:8px 12px;">‚úï</button>
    </div>
    <div style="width:100%;display:flex;gap:8px;">
      <input type="text" placeholder="Label Numar (ex: Joint-uri, Plicuri, Buc)" value="" data-step-idx="${newIdx}" data-field="numberLabel" style="flex:1;">
      <input type="text" placeholder="Label Greutate (ex: kg, grame, L)" value="kg" data-step-idx="${newIdx}" data-field="weightLabel" style="flex:1;">
    </div>
    <div style="width:100%;font-size:0.7rem;color:var(--dm);">
      üí° Exemplu afi»ôare: <b>160</b> Plicuri | <b>25.00</b> kg
    </div>
  `;
  container.appendChild(row);
}

function removeCalcStep(idx) {
  event.target.parentElement.remove();
}

function addCalcSummary() {
  const container = $('calc-summary-container');
  if (container.querySelector('div[style*="Apasa pentru"]')) {
    container.innerHTML = '';
  }
  
  const newIdx = container.querySelectorAll('.field-row').length;
  const row = document.createElement('div');
  row.className = 'field-row';
  row.innerHTML = `
    <input type="text" placeholder="Label (ex: Total KG)" data-summary-idx="${newIdx}" data-field="label">
    <input type="text" placeholder="Icon" value="üìä" maxlength="2" style="width:60px;" data-summary-idx="${newIdx}" data-field="icon">
    <input type="text" placeholder="ID (ex: total_kg)" data-summary-idx="${newIdx}" data-field="id">
    <button onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(row);
}

function removeCalcSummary(idx) {
  event.target.parentElement.remove();
}

function addCalcInput() {
  // Deprecated - nu se mai foloseste
}

function removeCalcInput(idx) {
  // Deprecated
}

function addCalcMaterial() {
  // Deprecated
}

function removeCalcMaterial(idx) {
  // Deprecated
}

function addCalcOutput() {
  // Deprecated
}

function removeCalcOutput(idx) {
  // Deprecated
}

function saveCalculator() {
  const id = $('calc-id').value.trim().toLowerCase();
  const name = $('calc-name').value.trim();
  const icon = $('calc-icon').value;
  const tabId = $('calc-tab').value.trim().toLowerCase();
  const formula = $('calc-formula').value.trim();
  const inputLabel = $('calc-input-label').value.trim();
  const inputIcon = $('calc-input-icon').value;
  const inputPlaceholder = $('calc-input-placeholder').value;
  
  if (!id || !name || !tabId) {
    alert('ID, Nume si Tab ID sunt obligatorii!');
    return;
  }
  
  if (!/^[a-z0-9_]+$/.test(id)) {
    alert('ID-ul poate contine doar litere mici, cifre si underscore!');
    return;
  }
  
  if (!/^[a-z0-9_]+$/.test(tabId)) {
    alert('Tab ID poate contine doar litere mici, cifre si underscore!');
    return;
  }
  
  // Colectez steps (etape)
  const steps = [];
  document.querySelectorAll('[data-step-idx]').forEach(elem => {
    const idx = elem.getAttribute('data-step-idx');
    const field = elem.getAttribute('data-field');
    
    if (!steps[idx]) {
      steps[idx] = {};
    }
    steps[idx][field] = elem.value.trim();
  });
  
  const validSteps = steps.filter(step => step && step.name);
  
  // Colectez summary (sumar final)
  const summary = [];
  document.querySelectorAll('[data-summary-idx]').forEach(elem => {
    const idx = elem.getAttribute('data-summary-idx');
    const field = elem.getAttribute('data-field');
    
    if (!summary[idx]) {
      summary[idx] = {};
    }
    summary[idx][field] = elem.value.trim();
  });
  
  const validSummary = summary.filter(sum => sum && sum.id && sum.label);
  
  if (validSteps.length === 0) {
    alert('Trebuie sa adaugi cel putin o etapa de procesare!');
    return;
  }
  
  if (validSummary.length === 0) {
    alert('Trebuie sa adaugi cel putin un rezultat in sumar!');
    return;
  }
  
  const newCalc = {
    id,
    name,
    icon,
    tabId,
    inputLabel,
    inputIcon,
    inputPlaceholder,
    steps: validSteps,
    summary: validSummary,
    formula
  };
  
  if (editingCalculator !== null) {
    calculators[editingCalculator] = newCalc;
  } else {
    if (calculators.find(c => c.id === id)) {
      alert('Exista deja un calculator cu acest ID!');
      return;
    }
    calculators.push(newCalc);
  }
  
  saveCalculators();
  closeModal();
  renderCalculatorsList();
  renderDynamicPanels();
  showNotification(`Calculator "${name}" a fost ${editingCalculator !== null ? 'actualizat' : 'adaugat'}!`);
}

function editCalculator(index) {
  openCalculatorModal(index);
}

function deleteCalculator(index) {
  if (!confirm('Sigur vrei sa stergi acest calculator?')) return;
  
  const name = calculators[index].name;
  calculators.splice(index, 1);
  saveCalculators();
  renderCalculatorsList();
  renderDynamicPanels();
  showNotification(`Calculator "${name}" a fost sters!`);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  RANDARE CATEGORII IN MAIN APP  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function renderMainCategories() {
  const container = $('main-categories');
  container.innerHTML = '';
  
  categories.forEach((cat, index) => {
    const btn = document.createElement('div');
    btn.className = `cat-group-btn ${cat.color} ${index === 0 ? 'on' : ''}`;
    // ‚úÖ CORECTAT: Folosim function pentru a pƒÉstra referin»õa la element
    btn.onclick = function() { showCategory(cat.id, this); };
    btn.innerHTML = `
      <span class="cg-icon">${cat.icon}</span>${cat.name}
      <div class="cg-sub">${cat.sub}</div>
    `;
    container.appendChild(btn);
  });
}

// ‚úÖ CORECTAT: AdƒÉugat parametrul clickedElement
function showCategory(catId, clickedElement) {
  // Update buttons
  document.querySelectorAll('.cat-group-btn').forEach(btn => btn.classList.remove('on'));
  clickedElement.classList.add('on');
  
  // Update panels
  document.querySelectorAll('.cat-panel').forEach(p => p.classList.remove('on'));
  const panel = $(`panel_${catId}`);
  if (panel) panel.classList.add('on');
}

// ‚úÖ CORECTAT: AdƒÉugat parametrul clickedTab
function switchSubTab(category, tabId, clickedTab) {
  const container = $(`panel_${category}`);
  container.querySelectorAll('.tb').forEach(b => b.classList.remove('on'));
  clickedTab.classList.add('on');
  
  container.querySelectorAll('.pn').forEach(p => p.classList.remove('on'));
  const panel = $(`${category}_${tabId}`);
  if (panel) panel.classList.add('on');
}

function renderDynamicPanels() {
  const container = $('dynamic-panels');
  container.innerHTML = '';
  
  categories.forEach((cat, index) => {
    const panel = document.createElement('div');
    panel.className = `cat-panel ${index === 0 ? 'on' : ''}`;
    panel.id = `panel_${cat.id}`;
    
    // GenereazƒÉ subcategoriile dinamic
    const subs = subcategories[cat.id] || [];
    let subTabsHTML = '';
    let subPanelsHTML = '';
    
    if (subs.length > 0) {
      subTabsHTML = `<div class="sub-tabs ${cat.color}" id="tabs_${cat.id}">` + 
        // ‚úÖ CORECTAT: AdƒÉugat 'this' ca parametru pentru switchSubTab
        subs.map((sub, i) => `<div class="tb ${i === 0 ? 'on' : ''}" onclick="switchSubTab('${cat.id}', '${sub.id}', this)">${sub.icon} ${sub.name}</div>`).join('') + 
        '</div>';
      
      subPanelsHTML = subs.map((sub, i) => {
        const content = generateSubcategoryContent(cat.id, sub);
        return `<div class="pn ${i === 0 ? 'on' : ''}" id="${cat.id}_${sub.id}">${content}</div>`;
      }).join('');
    }
    
    panel.innerHTML = subTabsHTML + subPanelsHTML;
    container.appendChild(panel);
  });
  
  // Ini»õializeazƒÉ calculatoarele
  setTimeout(() => {
    initB(); cB();
    initC();
    initA(); cA();
    initComp();
    initM();
    initL();
    
    // Ini»õializeazƒÉ calculatoarele personalizate
    calculators.forEach(calc => {
      calcCustom(calc.id);
    });
  }, 100);
}

function generateSubcategoryContent(catId, sub) {
  // GenereazƒÉ con»õinut bazat pe tipul subcategoriei
  switch(sub.type) {
    case 'calculator':
      return generateCalculatorContent(catId, sub);
    case 'table':
      return generateTableContent(catId, sub);
    case 'cards':
      return generateCardsContent(catId, sub);
    default:
      return `<div class="sc hl"><div class="st">‚ö†Ô∏è Tip necunoscut: ${sub.type}</div></div>`;
  }
}

function generateCalculatorContent(catId, sub) {
  // VerificƒÉ dacƒÉ existƒÉ calculatoare personalizate pentru acest tab
  const customCalcs = calculators.filter(c => c.tabId === sub.id);
  
  if (customCalcs.length > 0) {
    // GenereazƒÉ HTML pentru calculatoare personalizate - IDENTIC CU COCAINA
    let html = '';
    customCalcs.forEach(calc => {
      html += `
        <div class="sc gn">
          <div class="st green">${calc.icon} ${calc.name}</div>
          <div class="ir">
            <div class="ig">
              <label>${calc.inputIcon} ${calc.inputLabel}</label>
              <input type="number" id="calc_${calc.id}_input" placeholder="${calc.inputPlaceholder}" min="0" value="${calc.inputPlaceholder || 100}" oninput="calcCustom('${calc.id}')">
            </div>
          </div>
          <div class="ib">‚ú® Introdu ${calc.inputLabel.toLowerCase()} pentru a calcula intregul proces</div>
        </div>
        <div class="gr g3" id="calc_${calc.id}_cards"></div>
        <div class="sm">
          <div class="sm-t">üìä Sumar Final</div>
          <div class="sg" id="calc_${calc.id}_summary"></div>
        </div>
      `;
    });
    return html;
  }
  
  // Con»õinut pentru calculatoare hardcodate (cocaina, gloante, arme)
  if (sub.id === 'cocaina') {
    return `
      <div class="sc gn">
        <div class="st green">üíé Calculator Procesare Cocaina</div>
        <div class="ir">
          <div class="ig">
            <label>üåø Numar frunze de coca</label>
            <input type="number" id="cI" placeholder="560" min="0" value="560" oninput="cC()">
          </div>
        </div>
        <div class="ib">‚ú® Introdu numarul de frunze pentru a calcula intregul proces</div>
      </div>
      <div class="gr g3" id="cCards"></div>
      <div class="sm">
        <div class="sm-t">üìä Sumar Final</div>
        <div class="sg">
          <div class="si"><div class="lb">Total KG Procesate</div><div class="sv" id="cK">0.00</div></div>
          <div class="si"><div class="lb">Total Plicuri</div><div class="sv gl" id="cP">0</div></div>
          <div class="si"><div class="lb">Profit Estimat</div><div class="sv gn" id="cF">$0</div></div>
        </div>
      </div>
    `;
  } else if (sub.id === 'gloante') {
    return `
      <div class="sc hl">
        <div class="st">üéØ Selecteaza Calibrul</div>
        <div class="bs" id="bBtns"></div>
      </div>
      <div class="sc">
        <div class="ir">
          <div class="ig">
            <label>üî¢ Cate gloante vrei?</label>
            <input type="number" id="bI" placeholder="100" min="0" value="100" oninput="cB()">
          </div>
          <div class="mc bl"><div class="nm">Carcase Necesare</div><div class="vl" id="bC">0</div></div>
          <div class="mc gn"><div class="nm">Gloante Produse</div><div class="vl" id="bP">0</div></div>
        </div>
      </div>
      <div class="gr g3">
        <div class="mc cu"><div class="ic">ü•â</div><div class="nm">Cupru</div><div class="vl" id="bCu">0</div></div>
        <div class="mc lead"><div class="ic">‚öôÔ∏è</div><div class="nm">Plumb</div><div class="vl" id="bPb">0</div></div>
        <div class="mc gp"><div class="ic">üí•</div><div class="nm">Praf de Pusca</div><div class="vl" id="bPr">0</div></div>
      </div>
    `;
  } else if (sub.id === 'arme') {
    return `
      <div class="sc hl">
        <div class="st">üî´ Calculator Craft Arme</div>
        <div class="ir">
          <div class="ig"><label>Selecteaza Arma</label><select id="aS" onchange="cA()"></select></div>
          <div class="ig"><label>Cantitate</label><input type="number" id="aQ" value="1" min="1" max="100" oninput="cA()"></div>
        </div>
      </div>
      <div id="aR"></div>
    `;
  }
  return `<div class="sc"><div class="st">Calculator ${sub.name}</div></div>`;
}

function generateTableContent(catId, sub) {
  if (sub.id === 'componente') {
    return `<div class="sc hl"><div class="st cyan">‚öôÔ∏è Componente & Materiale Arme</div></div><div id="cT"></div>`;
  } else if (sub.id === 'masa') {
    return `<div class="sc hl"><div class="st gold">üî® Retete Masa de Craft</div></div><div id="mT"></div>`;
  }
  return `<div class="sc"><div class="st">Tabel ${sub.name}</div></div>`;
}

function generateCardsContent(catId, sub) {
  if (sub.id === 'locatii') {
    return `<div class="sc hl"><div class="st cyan">üìç Locatii Materiale</div></div><div id="lT"></div>`;
  }
  return `<div class="sc"><div class="st">Carduri ${sub.name}</div></div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  MANAGER DATE  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function renderDataTabs() {
  const container = $('data-categories');
  container.innerHTML = '';
  
  // Tab-uri pentru fiecare tip de date
  const dataTypes = [
    ['arme', 'üî´ Arme'],
    ['munitie', 'üéØ Munitie'],
    ['componente', '‚öôÔ∏è Componente'],
    ['masa', 'üî® Masa Craft'],
    ['locatii', 'üìç Locatii']
  ];
  
  dataTypes.forEach(([id, label]) => {
    const tab = document.createElement('div');
    tab.className = 'cat-tab ' + (id === currentDataCategory ? 'active' : '');
    tab.textContent = label;
    tab.onclick = () => {
      currentDataCategory = id;
      renderDataTabs();
      renderDataList();
    };
    container.appendChild(tab);
  });
}

function renderDataList() {
  const container = $('data-list');
  container.innerHTML = '';
  
  let data;
  switch(currentDataCategory) {
    case 'arme': data = ARME; break;
    case 'munitie': data = MUNITIE; break;
    case 'componente': data = COMP; break;
    case 'masa': data = MASA; break;
    case 'locatii': data = LOC; break;
  }
  
  Object.entries(data).forEach(([key, value]) => {
    const item = document.createElement('div');
    item.className = 'data-item';
    item.innerHTML = renderItemHTML(key, value);
    container.appendChild(item);
  });
}

function renderItemHTML(key, value) {
  let meta = '';
  switch(currentDataCategory) {
    case 'arme':
      meta = `Munitie: ${value.mun} | Piese: ${Object.keys(value.piese).length}`;
      return `
        <div class="data-item-info">
          <div class="data-item-name">üî´ ${key} ${catBadge(value.cat)}</div>
          <div class="data-item-meta">${meta}</div>
        </div>
        <div class="data-item-actions">
          <button class="icon-btn edit" onclick="editItem('${key}')">‚úèÔ∏è</button>
          <button class="icon-btn delete" onclick="deleteItem('${key}')">üóëÔ∏è</button>
        </div>`;
    case 'munitie':
      return `
        <div class="data-item-info">
          <div class="data-item-name">üéØ ${key}</div>
          <div class="data-item-meta">${value.gpc} gl/carcasa | ${value.cat}</div>
        </div>
        <div class="data-item-actions">
          <button class="icon-btn edit" onclick="editItem('${key}')">‚úèÔ∏è</button>
          <button class="icon-btn delete" onclick="deleteItem('${key}')">üóëÔ∏è</button>
        </div>`;
    case 'componente':
      return `
        <div class="data-item-info">
          <div class="data-item-name">‚öôÔ∏è ${key}</div>
          <div class="data-item-meta">${Object.keys(value.mat).length} materiale</div>
        </div>
        <div class="data-item-actions">
          <button class="icon-btn edit" onclick="editItem('${key}')">‚úèÔ∏è</button>
          <button class="icon-btn delete" onclick="deleteItem('${key}')">üóëÔ∏è</button>
        </div>`;
    case 'masa':
      return `
        <div class="data-item-info">
          <div class="data-item-name">üî® ${key} <span style="color: var(--s);">[${value.cat}]</span></div>
          <div class="data-item-meta">${value.mat.length} nivele</div>
        </div>
        <div class="data-item-actions">
          <button class="icon-btn edit" onclick="editItem('${key}')">‚úèÔ∏è</button>
          <button class="icon-btn delete" onclick="deleteItem('${key}')">üóëÔ∏è</button>
        </div>`;
    case 'locatii':
      return `
        <div class="data-item-info">
          <div class="data-item-name">${value.emoji} ${key}</div>
          <div class="data-item-meta">${value.mat.length} materiale | ${value.desc}</div>
        </div>
        <div class="data-item-actions">
          <button class="icon-btn edit" onclick="editItem('${key}')">‚úèÔ∏è</button>
          <button class="icon-btn delete" onclick="deleteItem('${key}')">üóëÔ∏è</button>
        </div>`;
  }
}

function openAddModal() {
  modalMode = 'data';
  editingItem = null;
  $('modal-title').textContent = `Adauga ${getCategoryLabel()}`;
  $('modal-content').innerHTML = generateFormFields();
  $('modal-overlay').classList.add('active');
}

function editItem(key) {
  modalMode = 'data';
  editingItem = key;
  $('modal-title').textContent = `Editeaza ${getCategoryLabel()}`;
  $('modal-content').innerHTML = generateFormFields(key);
  $('modal-overlay').classList.add('active');
}

function closeModal() {
  $('modal-overlay').classList.remove('active');
  editingItem = null;
  modalMode = 'data';
}

function getCategoryLabel() {
  const labels = {
    'arme': 'Arma',
    'munitie': 'Tip Munitie',
    'componente': 'Componenta',
    'masa': 'Reteta Masa',
    'locatii': 'Locatie'
  };
  return labels[currentDataCategory] || 'Intrare';
}

function generateFormFields(editKey = null) {
  let data = null;
  if (editKey) {
    switch(currentDataCategory) {
      case 'arme': data = ARME[editKey]; break;
      case 'munitie': data = MUNITIE[editKey]; break;
      case 'componente': data = COMP[editKey]; break;
      case 'masa': data = MASA[editKey]; break;
      case 'locatii': data = LOC[editKey]; break;
    }
  }
  
  let html = `
    <div class="form-group">
      <label>Nume / Identificator</label>
      <input type="text" id="field-name" value="${editKey || ''}" ${editKey ? 'readonly' : ''} 
             placeholder="Ex: Combat Pistol, 9mm, etc">
    </div>
  `;
  
  switch(currentDataCategory) {
    case 'arme':
      const categories = ['Pistol', 'SMG', 'Rifle', 'Shotgun', 'Heavy', 'MG', 'Special'];
      const munitieTypes = Object.keys(MUNITIE);
      html += `
        <div class="form-row">
          <div class="form-group">
            <label>Categorie</label>
            <select id="field-cat">
              ${categories.map(c => `<option value="${c}" ${data?.cat === c ? 'selected' : ''}>${c}</option>`).join('')}
            </select>
          </div>
          <div class="form-group">
            <label>Tip Munitie</label>
            <select id="field-mun">
              ${munitieTypes.map(m => `<option value="${m}" ${data?.mun === m ? 'selected' : ''}>${m}</option>`).join('')}
            </select>
          </div>
        </div>
        <div class="dynamic-fields">
          <h4>Piese Necesare <button type="button" onclick="addPiesaField()" style="padding: 4px 8px; background: var(--g); border: none; border-radius: 4px; color: #000; font-size: 0.7rem; cursor: pointer;">+ Adauga</button></h4>
          <div id="piese-container">
            ${data ? Object.entries(data.piese).map(([k, v]) => `
              <div class="field-row">
                <input type="text" placeholder="Nume piesa" value="${k}" class="piesa-name">
                <input type="number" placeholder="Cantitate" value="${v}" class="piesa-qty" style="width: 80px;">
                <button type="button" onclick="this.parentElement.remove()">‚úï</button>
              </div>
            `).join('') : ''}
          </div>
        </div>
      `;
      break;
      
    case 'munitie':
      html += `
        <div class="form-row">
          <div class="form-group">
            <label>Gloante per Carcasa</label>
            <input type="number" id="field-gpc" value="${data?.gpc || 30}" min="1">
          </div>
          <div class="form-group">
            <label>Categorie Arme</label>
            <input type="text" id="field-cat" value="${data?.cat || 'Pistol / SMG'}" placeholder="Ex: Pistol / SMG">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Cupru per Carcasa</label>
            <input type="number" id="field-cu" value="${data?.cu || 1}" min="0">
          </div>
          <div class="form-group">
            <label>Plumb per Carcasa</label>
            <input type="number" id="field-pb" value="${data?.pb || 1}" min="0">
          </div>
        </div>
        <div class="form-group">
          <label>Praf de Pusca per Carcasa</label>
          <input type="number" id="field-pr" value="${data?.pr || 1}" min="0">
        </div>
        <div class="form-group">
          <label>Reteta (text)</label>
          <textarea id="field-ret" placeholder="Ex: 1 Cupru + 1 Plumb + 1 Praf de Pusca = 30 gloante">${data?.ret || ''}</textarea>
        </div>
      `;
      break;
      
    case 'componente':
      html += `
        <div class="form-group">
          <label>Descriere</label>
          <textarea id="field-desc" placeholder="Descrierea componentei">${data?.desc || ''}</textarea>
        </div>
        <div class="dynamic-fields">
          <h4>Materiale Necesare <button type="button" onclick="addMaterialField()" style="padding: 4px 8px; background: var(--g); border: none; border-radius: 4px; color: #000; font-size: 0.7rem; cursor: pointer;">+ Adauga</button></h4>
          <div id="materiale-container">
            ${data ? Object.entries(data.mat).map(([k, v]) => `
              <div class="field-row">
                <input type="text" placeholder="Material" value="${k}" class="mat-name">
                <input type="text" placeholder="Cantitate" value="${v}" class="mat-qty" style="width: 100px;">
                <button type="button" onclick="this.parentElement.remove()">‚úï</button>
              </div>
            `).join('') : ''}
          </div>
        </div>
      `;
      break;
      
    case 'masa':
      html += `
        <div class="form-group">
          <label>Categorie</label>
          <select id="field-cat">
            <option value="Unelte" ${data?.cat === 'Unelte' ? 'selected' : ''}>Unelte</option>
            <option value="Materiale" ${data?.cat === 'Materiale' ? 'selected' : ''}>Materiale</option>
            <option value="Electronice" ${data?.cat === 'Electronice' ? 'selected' : ''}>Electronice</option>
          </select>
        </div>
        <div class="dynamic-fields">
          <h4>Retete pe Nivele <button type="button" onclick="addNivelField()" style="padding: 4px 8px; background: var(--g); border: none; border-radius: 4px; color: #000; font-size: 0.7rem; cursor: pointer;">+ Adauga</button></h4>
          <div id="nivele-container">
            ${data ? data.mat.map((m, i) => `
              <div class="field-row">
                <span style="color: var(--dm); font-size: 0.8rem; min-width: 50px;">LVL ${i+1}:</span>
                <input type="text" placeholder="Materiale" value="${m}" class="nivel-mat" style="flex: 1;">
                <button type="button" onclick="this.parentElement.remove()">‚úï</button>
              </div>
            `).join('') : ''}
          </div>
        </div>
      `;
      break;
      
    case 'locatii':
      html += `
        <div class="form-row">
          <div class="form-group">
            <label>Emoji</label>
            <input type="text" id="field-emoji" value="${data?.emoji || 'üìç'}" placeholder="üìç" maxlength="2">
          </div>
          <div class="form-group">
            <label>Descriere Job</label>
            <input type="text" id="field-desc" value="${data?.desc || ''}" placeholder="Ex: Job: Miner">
          </div>
        </div>
        <div class="dynamic-fields">
          <h4>Materiale Disponibile <button type="button" onclick="addLocMaterialField()" style="padding: 4px 8px; background: var(--g); border: none; border-radius: 4px; color: #000; font-size: 0.7rem; cursor: pointer;">+ Adauga</button></h4>
          <div id="loc-mat-container">
            ${data ? data.mat.map(m => `
              <div class="field-row">
                <input type="text" placeholder="Material" value="${m}" class="loc-mat" style="flex: 1;">
                <button type="button" onclick="this.parentElement.remove()">‚úï</button>
              </div>
            `).join('') : ''}
          </div>
        </div>
      `;
      break;
  }
  
  return html;
}

// Func»õii helper pentru c√¢mpuri dinamice
function addPiesaField() {
  const container = $('piese-container');
  const div = document.createElement('div');
  div.className = 'field-row';
  div.innerHTML = `
    <input type="text" placeholder="Nume piesa" class="piesa-name">
    <input type="number" placeholder="Cantitate" value="1" class="piesa-qty" style="width: 80px;">
    <button type="button" onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(div);
}

function addMaterialField() {
  const container = $('materiale-container');
  const div = document.createElement('div');
  div.className = 'field-row';
  div.innerHTML = `
    <input type="text" placeholder="Material" class="mat-name">
    <input type="text" placeholder="Cantitate" value="1x" class="mat-qty" style="width: 100px;">
    <button type="button" onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(div);
}

function addNivelField() {
  const container = $('nivele-container');
  const count = container.children.length + 1;
  const div = document.createElement('div');
  div.className = 'field-row';
  div.innerHTML = `
    <span style="color: var(--dm); font-size: 0.8rem; min-width: 50px;">LVL ${count}:</span>
    <input type="text" placeholder="Materiale" class="nivel-mat" style="flex: 1;">
    <button type="button" onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(div);
}

function addLocMaterialField() {
  const container = $('loc-mat-container');
  const div = document.createElement('div');
  div.className = 'field-row';
  div.innerHTML = `
    <input type="text" placeholder="Material" class="loc-mat" style="flex: 1;">
    <button type="button" onclick="this.parentElement.remove()">‚úï</button>
  `;
  container.appendChild(div);
}

function saveData() {
  if (modalMode === 'category') {
    saveCategory();
    return;
  }
  
  if (modalMode === 'subcategory') {
    saveSubcategory();
    return;
  }
  
  // Check daca este modal de calculator
  if ($('calc-id')) {
    saveCalculator();
    return;
  }
  
  const name = $('field-name').value.trim();
  if (!name) {
    alert('Numele este obligatoriu!');
    return;
  }
  
  let newData;
  
  try {
    switch(currentDataCategory) {
      case 'arme':
        newData = {
          cat: $('field-cat').value,
          mun: $('field-mun').value,
          piese: {}
        };
        document.querySelectorAll('.piesa-name').forEach((input, i) => {
          const qty = document.querySelectorAll('.piesa-qty')[i].value;
          if (input.value.trim()) {
            newData.piese[input.value.trim()] = parseInt(qty) || 1;
          }
        });
        break;
        
      case 'munitie':
        newData = {
          gpc: parseInt($('field-gpc').value) || 30,
          cat: $('field-cat').value,
          cu: parseInt($('field-cu').value) || 0,
          pb: parseInt($('field-pb').value) || 0,
          pr: parseInt($('field-pr').value) || 0,
          ret: $('field-ret').value
        };
        break;
        
      case 'componente':
        newData = {
          desc: $('field-desc').value,
          mat: {}
        };
        document.querySelectorAll('.mat-name').forEach((input, i) => {
          const qty = document.querySelectorAll('.mat-qty')[i].value;
          if (input.value.trim()) {
            newData.mat[input.value.trim()] = qty;
          }
        });
        break;
        
      case 'masa':
        newData = {
          cat: $('field-cat').value,
          mat: []
        };
        document.querySelectorAll('.nivel-mat').forEach(input => {
          if (input.value.trim()) {
            newData.mat.push(input.value.trim());
          }
        });
        break;
        
      case 'locatii':
        newData = {
          emoji: $('field-emoji').value || 'üìç',
          desc: $('field-desc').value,
          mat: []
        };
        document.querySelectorAll('.loc-mat').forEach(input => {
          if (input.value.trim()) {
            newData.mat.push(input.value.trim());
          }
        });
        break;
    }
    
    switch(currentDataCategory) {
      case 'arme': ARME[name] = newData; break;
      case 'munitie': MUNITIE[name] = newData; break;
      case 'componente': COMP[name] = newData; break;
      case 'masa': MASA[name] = newData; break;
      case 'locatii': LOC[name] = newData; break;
    }
    
    saveAppData();
    renderDataList();
    refreshAppUI();
    
    closeModal();
    showNotification(`${getCategoryLabel()} "${name}" a fost ${editingItem ? 'actualizat' : 'adaugat'}!`);
    
  } catch (e) {
    alert('Eroare la salvare: ' + e.message);
  }
}

function deleteItem(key) {
  if (!confirm(`Sigur vrei sƒÉ »ôtergi "${key}"?`)) return;
  
  switch(currentDataCategory) {
    case 'arme': delete ARME[key]; break;
    case 'munitie': delete MUNITIE[key]; break;
    case 'componente': delete COMP[key]; break;
    case 'masa': delete MASA[key]; break;
    case 'locatii': delete LOC[key]; break;
  }
  
  saveAppData();
  renderDataList();
  refreshAppUI();
  showNotification(`${getCategoryLabel()} "${key}" a fost »ôters!`);
}

function refreshAppUI() {
  initB(); cB();
  initA(); cA();
  initComp();
  initM();
  initL();
  renderDynamicPanels();
}

function exportData() {
  const exportObj = {
    categories: categories,
    subcategories: subcategories,
    data: APP_DATA,
    exportDate: new Date().toISOString(),
    exportedBy: currentUser?.username || 'Unknown'
  };
  
  const dataStr = JSON.stringify(exportObj, null, 2);
  const dataBlob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `craft_backup_${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  URL.revokeObjectURL(url);
  showNotification('üíæ Date exportate cu succes!');
}

function importData() {
  $('import-file').click();
}

function handleImport(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      
      if (imported.categories) {
        categories = imported.categories;
        saveCategories();
      }
      
      if (imported.subcategories) {
        subcategories = imported.subcategories;
        saveSubcategories();
      }
      
      if (imported.data) {
        APP_DATA = imported.data;
        MUNITIE = APP_DATA.MUNITIE;
        ARME = APP_DATA.ARME;
        COMP = APP_DATA.COMP;
        MATARME = APP_DATA.MATARME;
        MASA = APP_DATA.MASA;
        LOC = APP_DATA.LOC;
        saveAppData();
      }
      
      renderCategoriesList();
      renderSubcategoriesList();
      renderMainCategories();
      renderDynamicPanels();
      renderDataTabs();
      renderDataList();
      refreshAppUI();
      
      showNotification('üì• Date importate cu succes!');
    } catch (err) {
      alert('Eroare la import: ' + err.message);
    }
  };
  reader.readAsText(file);
  
  // Reset input
  event.target.value = '';
}

function showNotification(message) {
  const notif = document.createElement('div');
  notif.style.cssText = `
    position: fixed; bottom: 20px; right: 20px; z-index: 10002;
    background: linear-gradient(135deg, var(--owner), #990000);
    color: white; padding: 16px 24px; border-radius: 12px;
    font-family: 'Rajdhani', sans-serif; font-weight: 700;
    box-shadow: 0 10px 30px var(--owner-glow);
    animation: slideIn 0.3s ease;
  `;
  notif.textContent = message;
  document.body.appendChild(notif);
  
  setTimeout(() => {
    notif.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notif.remove(), 300);
  }, 3000);
}

const $ = id => document.getElementById(id);
const F = n => Math.floor(n).toLocaleString('ro-RO');

function A(id, v) {
  const e = $(id); 
  if (!e) return;
  e.textContent = v; 
  e.classList.remove('up');
  void e.offsetWidth; 
  e.classList.add('up');
}

function catBadge(cat) {
  const c = cat.toLowerCase().replace(/\s.*/, '');
  const map = { pistol: 'pistol', smg: 'smg', rifle: 'rifle', shotgun: 'shotgun', heavy: 'heavy', mg: 'mg', special: 'special' };
  return `<span class="cat-badge ${map[c] || 'special'}">${cat}</span>`;
}

let curB = Object.keys(MUNITIE)[0] || '9mm';

function initB() {
  const c = $('bBtns');
  if (!c) return;
  c.innerHTML = '';
  
  Object.entries(MUNITIE).forEach(([k, v]) => {
    const b = document.createElement('div');
    b.className = 'bt' + (k === curB ? ' on' : '');
    b.innerHTML = `<span>${k}</span><small>${v.gpc} gl/carcasa</small>`;
    b.onclick = () => {
      curB = k;
      document.querySelectorAll('#bBtns .bt').forEach(x => x.classList.remove('on'));
      b.classList.add('on'); 
      cB();
    };
    c.appendChild(b);
  });
}

function cB() {
  const w = parseInt($('bI')?.value) || 0;
  const cfg = MUNITIE[curB]; 
  if (!cfg) return;
  
  const ca = Math.ceil(w / cfg.gpc);
  const pr = ca * cfg.gpc;
  const cu = ca * cfg.cu;
  const pb = ca * cfg.pb;
  const pf = ca * cfg.pr;
  
  A('bC', F(ca)); 
  A('bP', F(pr));
  A('bCu', F(cu)); 
  A('bPb', F(pb)); 
  A('bPr', F(pf));
}

const COCA_STEPS = [
  ['Frunze de Coca', 'üåø', 'gn'],
  ['Sticle (Extractie)', 'üß™', 'bl'],
  ['Tavi (Uscare)', 'üç≥', 'gl'],
  ['Brichete (Presare)', 'üß±', 'rd'],
  ['Pungi (Impartire)', 'üëú', 'vt'],
  ['Plicuri (Final)', 'üì¶', 'gn'],
];

function initC() {
  const c = $('cCards');
  if (!c) return;
  
  c.innerHTML = '';
  COCA_STEPS.forEach((s, i) => {
    c.innerHTML += `<div class="mc ${s[2]}"><div class="ic">${s[1]}</div><div class="nm">${s[0]}</div><div class="vl" id="cc${i}">0</div><div class="un" id="ck${i}">0.00 kg</div></div>`;
  });
}

function cC() {
  const f = parseInt($('cI')?.value) || 0;
  
  const fk = .04 * f;
  const sn = .05 * f;
  const sk = .4 * sn;
  const tn = sn;
  const tk = .3 * tn;
  const bn = tn;
  const bk = .2 * bn;
  const pn = 2 * bn;
  const pk = .03 * pn;
  const ln = pn;
  const lk = .2 * ln;
  
  const vals = [[f, fk], [sn, sk], [tn, tk], [bn, bk], [pn, pk], [ln, lk]];
  
  vals.forEach(([n, k], i) => { 
    A('cc' + i, F(Math.floor(n))); 
    if ($('ck' + i)) $('ck' + i).textContent = k.toFixed(2) + ' kg';
  });
  
  A('cK', (fk + sk + tk + bk + pk).toFixed(2));
  A('cP', F(Math.floor(ln)));
  A('cF', '$' + F(Math.floor(ln * 13600)));
}

function initA() {
  const s = $('aS');
  if (!s) return;
  
  s.innerHTML = '';
  const cats = {};
  
  Object.entries(ARME).forEach(([k, v]) => {
    if (!cats[v.cat]) cats[v.cat] = [];
    cats[v.cat].push(k);
  });
  
  Object.entries(cats).forEach(([cat, names]) => {
    const g = document.createElement('optgroup');
    g.label = cat;
    names.forEach(n => { 
      const o = document.createElement('option'); 
      o.value = n; 
      o.textContent = n; 
      g.appendChild(o);
    });
    s.appendChild(g);
  });
}

function cA() {
  const n = $('aS')?.value;
  const q = parseInt($('aQ')?.value) || 1;
  const a = ARME[n]; 
  if (!a) return;
  
  let h = `<div class="sc"><div class="st">${n} √ó ${q}</div>
  <div class="ib">Categorie: ${catBadge(a.cat)} &nbsp; Munitie: <b style="color:var(--s)">${a.mun}</b></div>
  <table><tr><th>Piesa</th><th>Per Arma</th><th>Total (√ó${q})</th></tr>`;
  
  let t = 0;
  Object.entries(a.piese).forEach(([p, nr]) => {
    h += `<tr><td>${p}</td><td>${nr}√ó</td><td><b>${nr * q}√ó</b></td></tr>`;
    t += nr * q;
  });
  
  h += `<tr style="border-top:2px solid var(--p)"><td colspan="2"><b style="color:var(--a)">TOTAL PIESE</b></td><td><b style="color:var(--s);font-size:1.1rem">${t}√ó</b></td></tr></table></div>`;
  
  const m = MUNITIE[a.mun];
  if (m) {
    h += `<div class="sc"><div class="st cyan">üéØ Munitie Recomandata: ${a.mun}</div>
    <div class="rc"><b>${m.ret}</b></div>
    <div class="ib">Foloseste tab-ul <b>üéØ Gloante</b> pentru calculator detaliat munitie</div></div>`;
  }
  
  if ($('aR')) $('aR').innerHTML = h;
}

function initComp() {
  if (!$('cT')) return;
  
  let h = `<div class="sc"><div class="st cyan">üî© Componente Craft</div>
  <table><tr><th>Componenta</th><th>Materiale Necesare</th><th>Descriere</th></tr>`;
  
  Object.entries(COMP).forEach(([k, v]) => {
    const mats = Object.values(v.mat).map(m => `<span style="color:var(--s)">${m}</span>`).join(', ');
    h += `<tr><td><b>${k}</b></td><td>${mats}</td><td style="color:var(--dm)">${v.desc}</td></tr>`;
  });
  
  h += `</table></div>`;

  h += `<div class="sc"><div class="st">üõ†Ô∏è Materiale Arme ‚Üí Piese de Arme</div>
  <table><tr><th>Piesa</th><th>Piese Arme Necesare</th><th>Categorie</th></tr>`;
  
  Object.entries(MATARME).forEach(([k, v]) => {
    h += `<tr><td><b>${k}</b></td><td style="color:var(--s);font-weight:700">${v.pa}√ó</td><td>${catBadge(v.cat)}</td></tr>`;
  });
  
  h += `</table></div>`;
  $('cT').innerHTML = h;
}

function initM() {
  if (!$('mT')) return;
  
  const cats = {};
  Object.entries(MASA).forEach(([k, v]) => {
    if (!cats[v.cat]) cats[v.cat] = [];
    cats[v.cat].push([k, v]);
  });

  let h = '';
  Object.entries(cats).forEach(([cat, items]) => {
    h += `<div class="sc"><div class="st gold">üî® ${cat.toUpperCase()}</div>`;
    items.forEach(([name, data]) => {
      h += `<div style="margin:12px 0;padding:14px;background:rgba(255,215,0,.04);border:1px solid rgba(255,215,0,.12);border-radius:10px">
      <div style="font-weight:700;color:var(--s);margin-bottom:8px;font-size:1rem">${name}</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px">`;
      data.mat.forEach((m, i) => {
        h += `<div style="padding:6px 12px;background:rgba(0,212,255,.06);border:1px solid rgba(0,212,255,.15);border-radius:8px;font-size:.82rem">
        <span style="color:var(--dm);font-size:.65rem">LVL ${i+1}</span><br>
        <span style="color:var(--a);font-weight:600">${m}</span></div>`;
      });
      h += `</div></div>`;
    });
    h += `</div>`;
  });
  
  $('mT').innerHTML = h;
}

function initL() {
  if (!$('lT')) return;
  
  let h = '<div class="gr g2">';
  Object.entries(LOC).forEach(([k, v]) => {
    h += `<div class="mc bl" style="text-align:left;padding:20px">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
      <span style="font-size:2rem">${v.emoji}</span>
      <div>
        <div style="font-family:'Orbitron',monospace;font-size:.8rem;color:var(--s);font-weight:700;letter-spacing:1px">${k}</div>
        <div style="font-size:.7rem;color:var(--dm)">${v.desc}</div>
      </div>
    </div>`;
    v.mat.forEach(m => {
      h += `<div style="padding:6px 0;color:var(--tx);font-size:.88rem;border-bottom:1px solid rgba(255,255,255,.04)">
      <span style="color:var(--a);margin-right:6px">‚ñ∏</span>${m}</div>`;
    });
    h += '</div>';
  });
  h += '</div>';
  $('lT').innerHTML = h;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  CALCULATOR PERSONALIZAT - RUNTIME  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function calcCustom(calcId) {
  const calc = calculators.find(c => c.id === calcId);
  if (!calc) {
    console.error('Calculator nu exista:', calcId);
    return;
  }
  
  // Iau valoarea din input
  const inputElem = $(`calc_${calcId}_input`);
  const inputValue = inputElem ? parseFloat(inputElem.value) || 0 : 0;
  
  const inputs = { cantitate: inputValue };
  
  // Execut formula personalizatƒÉ
  try {
    let result = { steps: [], summary: {} };
    
    if (calc.formula && calc.formula.trim()) {
      const formulaFunc = new Function('inputs', calc.formula);
      result = formulaFunc(inputs) || { steps: [], summary: {} };
    }
    
    // RandeazƒÉ cardurile pentru etape (identic cu cocaina)
    const cardsContainer = $(`calc_${calcId}_cards`);
    if (cardsContainer && result.steps && calc.steps.length > 0) {
      cardsContainer.innerHTML = '';
      
      calc.steps.forEach((step, i) => {
        const stepData = result.steps[i] || [0, 0];
        const number = stepData[0] || 0;
        const weight = stepData[1] || 0;
        
        const card = document.createElement('div');
        card.className = `mc ${step.color || 'gn'}`;
        card.innerHTML = `
          <div class="ic">${step.icon}</div>
          <div class="nm">${step.name}</div>
          <div class="vl">${Math.floor(number)}</div>
          <div class="un">${weight.toFixed(2)} ${step.weightLabel || 'kg'}</div>
        `;
        
        // DacƒÉ existƒÉ numberLabel, adaugƒÉ text personalizat sub numƒÉr
        if (step.numberLabel) {
          const vlDiv = card.querySelector('.vl');
          vlDiv.innerHTML = `${Math.floor(number)}<div style="font-size:0.65rem;color:var(--dm);margin-top:2px;">${step.numberLabel}</div>`;
        }
        
        cardsContainer.appendChild(card);
      });
    }
    
    // RandeazƒÉ sumarul final (identic cu cocaina)
    const summaryContainer = $(`calc_${calcId}_summary`);
    if (summaryContainer && result.summary && calc.summary.length > 0) {
      summaryContainer.innerHTML = '';
      
      calc.summary.forEach(sum => {
        const value = result.summary[sum.id] !== undefined ? result.summary[sum.id] : 0;
        
        const summaryItem = document.createElement('div');
        summaryItem.className = 'si';
        
        let formattedValue = value;
        if (typeof value === 'number') {
          if (sum.id.includes('profit') || sum.id.includes('pret') || sum.id.includes('bani')) {
            formattedValue = '$' + F(Math.floor(value));
          } else if (sum.id.includes('kg') || sum.id.includes('weight') || sum.id.includes('greutate')) {
            formattedValue = value.toFixed(2);
          } else {
            formattedValue = F(Math.floor(value));
          }
        }
        
        summaryItem.innerHTML = `
          <div class="lb">${sum.label}</div>
          <div class="sv gl">${formattedValue}</div>
        `;
        summaryContainer.appendChild(summaryItem);
      });
    }
    
  } catch (err) {
    console.error('Eroare la executia formulei pentru', calcId, ':', err);
    
    const cardsContainer = $(`calc_${calcId}_cards`);
    if (cardsContainer) {
      cardsContainer.innerHTML = '<div style="color:var(--r);text-align:center;padding:20px;">‚ö†Ô∏è Eroare formula: ' + err.message + '</div>';
    }
  }
}

// ‚úÖ CORECTAT: Verificare defensivƒÉ pentru canvas
function initParticles() {
  const c = $('particles');
  if (!c) {
    console.warn('Canvas #particles nu a fost gƒÉsit');
    return;
  }
  
  const ctx = c.getContext('2d');
  if (!ctx) {
    console.warn('Context 2D nu este suportat');
    return;
  }
  
  let W, H, pts = [];
  
  function resize() { 
    W = c.width = innerWidth; 
    H = c.height = innerHeight;
  }
  
  resize(); 
  addEventListener('resize', resize);
  
  for (let i = 0; i < 40; i++) {
    pts.push({
      x: Math.random() * W, 
      y: Math.random() * H,
      r: Math.random() * 1.5 + .5, 
      dx: (Math.random() - .5) * .3, 
      dy: (Math.random() - .5) * .3,
      a: Math.random() * .3 + .1
    });
  }
  
  function draw() {
    ctx.clearRect(0, 0, W, H);
    pts.forEach(p => {
      p.x += p.dx; 
      p.y += p.dy;
      if (p.x < 0) p.x = W; 
      if (p.x > W) p.x = 0;
      if (p.y < 0) p.y = H; 
      if (p.y > H) p.y = 0;
      
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255,107,53,${p.a})`;
      ctx.fill();
    });
    
    for (let i = 0; i < pts.length; i++) {
      for (let j = i + 1; j < pts.length; j++) {
        const dx = pts[i].x - pts[j].x;
        const dy = pts[i].y - pts[j].y;
        const d = Math.sqrt(dx * dx + dy * dy);
        if (d < 120) {
          ctx.beginPath();
          ctx.moveTo(pts[i].x, pts[i].y);
          ctx.lineTo(pts[j].x, pts[j].y);
          ctx.strokeStyle = `rgba(255,107,53,${.06 * (1 - d / 120)})`;
          ctx.lineWidth = .5;
          ctx.stroke();
        }
      }
    }
    
    requestAnimationFrame(draw);
  }
  
  draw();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ñà‚ñà‚ñà  INITIALIZARE  ‚ñà‚ñà‚ñà
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

if (window.location.hash.includes('access_token')) {
  handleDiscordCallback();
} else {
  initParticles();
  checkAccess();
}
</script>
</body>
</html>
